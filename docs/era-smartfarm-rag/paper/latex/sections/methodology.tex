% Section 3: Methodology
% Converted from: 03_methodology.md
% Updated: 2026-01-16 - Applied 2-Lane architecture design (Option B)

\section{ì œì•ˆ ë°©ë²•ë¡  (Proposed Methodology)}
\label{sec:methodology}

\subsection{ì „ì²´ ì‹œìŠ¤í…œ ê°œìš” ë° ì²˜ë¦¬ íë¦„}

ë³¸ ì—°êµ¬ëŠ” ìŠ¤ë§ˆíŠ¸íŒœ í˜„ì¥ì˜ ìì› ì œì•½ í™˜ê²½(8GB RAM)ì—ì„œ ê·¼ê±° ê¸°ë°˜ ì‹¤ì‹œê°„ ì‘ë‹µì„ ì œê³µí•˜ëŠ” ì˜¨ë””ë°”ì´ìŠ¤ RAG ì‹œìŠ¤í…œì„ ì œì•ˆí•œë‹¤. Figure~\ref{fig:full_flow}ëŠ” ì—°êµ¬ ì „ì²´ ìƒì• ì£¼ê¸°ì™€ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ë¥¼ \textbf{3-ë ˆì¸ íƒ€ì„ë¼ì¸ êµ¬ì¡°}ë¡œ ì œì‹œí•œë‹¤:

\begin{itemize}
	\item \textbf{System Pipeline (ìƒë‹¨, ì²­ìƒ‰)}: ì‹¤ì œ ì—£ì§€ ë””ë°”ì´ìŠ¤ì— ë°°í¬ë˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œ (7ë‹¨ê³„)
	\item \textbf{Evaluation Protocol (í•˜ë‹¨, ì£¼í™©ìƒ‰)}: ì‹œìŠ¤í…œ ê²€ì¦ì„ ìœ„í•œ ì—°êµ¬ ë°©ë²•ë¡  (Section~\ref{sec:experiments}ì—ì„œ ìƒì„¸ ê¸°ìˆ )
\end{itemize}

\subsubsection{End-to-End ì²˜ë¦¬ íë¦„}

% [Figure 1 placeholder - 3-Lane Timeline Architecture]
\begin{figure*}[htbp]
	\centering
	\fbox{\parbox{0.95\textwidth}{\centering \textbf{[Figure 1: Research Lifecycle \& System Architecture (3-Lane Timeline)]} \\[1em]
			\textcolor{blue}{\textbf{ğŸ”µ SYSTEM PIPELINE (Top Lane)}} \\[0.5em]
			\textbf{PHASE 1: Data Preparation (Offline)} \\
			â‘  Data Collection $\rightarrow$ â‘¡ Preprocessing (OCR, Chunking) $\rightarrow$ â‘¢ Knowledge Store \\[0.5em]
			$\downarrow$ \textit{mmap load} \\[0.5em]
			\textbf{PHASE 2: Online Inference (Per-query)} \\
			â‘£ Query Analysis $\rightarrow$ â‘¤ HybridDAT Retrieval $\rightarrow$ â‘¥ Context Shaping \\
			$\rightarrow$ â‘¦ LLM Generation $\rightarrow$ OUTPUT \{answer, sources, confidence\} \\[1em]
			\hrulefill \\[0.5em]
			\textcolor{orange}{\textbf{ğŸŸ  EVALUATION PROTOCOL (Bottom Lane)}} \\[0.5em]
			Verification | Ablation Study | Benchmark Comparison \\
			$\rightarrow$ Evaluation Metrics (Recall@k, Latency, Memory, LLM-Judge)
		}}
	\caption{ì œì•ˆ ì‹œìŠ¤í…œì˜ 3-ë ˆì¸ íƒ€ì„ë¼ì¸ ì•„í‚¤í…ì²˜. System Pipeline(ìƒë‹¨)ì€ ì‹¤ì œ ë°°í¬ë˜ëŠ” êµ¬ì„±ìš”ì†Œë¥¼, Evaluation Protocol(í•˜ë‹¨)ì€ ì—°êµ¬ ë°©ë²•ë¡ ì„ ë³´ì—¬ì¤€ë‹¤.}
	\label{fig:full_flow}
\end{figure*}

\textbf{System Pipeline (7ë‹¨ê³„)}:

\begin{table}[htbp]
	\centering
	\small
	\begin{tabular}{c|l|p{9cm}}
		\hline
		\textbf{ë‹¨ê³„} & \textbf{êµ¬ì„±ìš”ì†Œ}   & \textbf{ì„¤ëª…}                                                                                                                       \\
		\hline
		â‘            & Data Collection & PDF, ì´ë¯¸ì§€, í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë†ì—… ë§¤ë‰´ì–¼/ê°€ì´ë“œ ìˆ˜ì§‘                                                                                                   \\
		â‘¡           & Preprocessing   & Text extraction, OCR fallback (auto backend), Sentence-window chunking (CHUNK\_SIZE/STRIDE), Metadata tag (crop, causal, numeric) \\
		â‘¢           & Knowledge Store & Dense/Sparse ì¸ë±ìŠ¤ (mmap/TF-IDF), Causal Graph (in-memory, built from docs), Ontology                                               \\
		â‘£           & Query Analysis  & ì˜¨í†¨ë¡œì§€ ë§¤ì¹­, Dynamic Alpha (rule-based heuristics)                                                                                    \\
		â‘¤           & HybridDAT       & 3ì±„ë„ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (Dense FAISS + Sparse TF-IDF + PathRAG BFS 2-hop)                                                                    \\
		â‘¥           & Context Shaping & ì‘ë¬¼ í•„í„°ë§ (+0.5/Ã—0.15), ì¤‘ë³µ ì œê±° (Î¸=0.85), ë¦¬ë­í‚¹                                                                                          \\
		â‘¦           & LLM Generation  & llama.cpp Q4\_K\_M ê¸°ë°˜ ì‘ë‹µ ìƒì„±, Fallback chain                                                                                       \\
		\hline
	\end{tabular}
\end{table}

\textbf{í•µì‹¬ ì„¤ê³„ ì›ì¹™}:
\begin{enumerate}
	\item \textbf{ì˜¤í”„ë¼ì¸ ì‚¬ì „ êµ¬ì¶•}: ì¸ë±ì‹±/ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„(in-memory ë¹Œë“œ)ëŠ” 1íšŒ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ìˆ˜í–‰í•˜ì—¬ ëŸ°íƒ€ì„ ë¶€í•˜ ìµœì†Œí™”
	\item \textbf{ë©”ëª¨ë¦¬ íš¨ìœ¨}: mmap ê¸°ë°˜ lazy loadingìœ¼ë¡œ ì „ì²´ ì¸ë±ìŠ¤ë¥¼ RAMì— ì˜¬ë¦¬ì§€ ì•ŠìŒ
	\item \textbf{ë„ë©”ì¸ íŠ¹í™”}: ì˜¨í†¨ë¡œì§€ +Dynamic Alpha íœ´ë¦¬ìŠ¤í‹±ìœ¼ë¡œ ë²”ìš© RAG ëŒ€ë¹„ ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ
	\item \textbf{ê²€ì¦ ë¶„ë¦¬}: Groundedness Checks(keyword/source-hit) + Prompt ConstraintsëŠ” Evaluation Protocolë¡œ ë¶„ë¦¬í•˜ì—¬ í•™ìˆ ì  ê·œì•½ ì¤€ìˆ˜
\end{enumerate}

\textit{Note: Evaluation Protocol (Verification, Ablation, Benchmark)ì€ ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œê°€ ì•„ë‹Œ ì—°êµ¬ ë°©ë²•ë¡ ìœ¼ë¡œ, Section~\ref{sec:experiments}ì—ì„œ ìƒì„¸íˆ ë‹¤ë£¬ë‹¤. Verificationì€ í”„ë¡¬í”„íŠ¸ ì œì•½ ë° í‚¤ì›Œë“œ ê¸°ë°˜ ê·¼ê±° í™•ì¸ìœ¼ë¡œ êµ¬í˜„ë˜ë©°, BenchmarkëŠ” ë‚´ë¶€ ë² ì´ìŠ¤ë¼ì¸(Dense-only, Sparse-only, Naive Hybrid)ê³¼ ë¹„êµí•œë‹¤.}

\subsubsection{ë¦¬ì†ŒìŠ¤ ì œì•½ ë° ì„¤ê³„ ëª©í‘œ}

ì—£ì§€ í™˜ê²½ì˜ ë¦¬ì†ŒìŠ¤ ì œì•½ì„ ëª…í™•íˆ ì •ì˜í•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ì„¤ê³„í•˜ì˜€ë‹¤.

\input{tables/methodology/resource-constraints}

\subsubsection{6ê³„ì¸µ ì•„í‚¤í…ì²˜}

% [Figure 2 placeholder - 6-layer architecture diagram]
\begin{figure}[htbp]
	\centering
	\fbox{\parbox{0.9\textwidth}{\centering \textbf{[Figure 2: 6-Layer Stack Architecture]} \\[1em]
			L5: Application \& Policy (Streamlit UI, FastAPI REST, Offline Fallback) \\
			L4: Generation \& Grounding (Prompt Template, TemplateResponder) \\
			L3: Context Shaping (Crop Filter, Semantic Dedup, Reranking) \\
			L2: Retrieval Core (Dense/Sparse/PathRAG 3-channel) \\
			L1: On-device Knowledge Store (FAISS, Causal Graph, Ontology) \\
			L0: Device \& Runtime (llama.cpp, Embedding, FAISS mmap)
		}}
	\caption{ì œì•ˆ ì‹œìŠ¤í…œì˜ 6ê³„ì¸µ ìŠ¤íƒ ì•„í‚¤í…ì²˜}
	\label{fig:architecture}
\end{figure}

\textbf{ê³„ì¸µë³„ í•µì‹¬ ì—­í• }:

\input{tables/methodology/layers}

%----------------------------------------------------------------------
\subsection{ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸}

\subsubsection{ë°ì´í„° ìˆ˜ì§‘}

ë³¸ ì—°êµ¬ì˜ ì§€ì‹ ë² ì´ìŠ¤ëŠ” ì„¸ ê°€ì§€ ìœ í˜•ì˜ ë†ì—… ë¬¸ì„œë¡œ êµ¬ì„±ëœë‹¤: (1) ì¬ë°° ë§¤ë‰´ì–¼ (ë†ì´Œì§„í¥ì²­, ë„ë†ì—…ê¸°ìˆ ì› PDF), (2) ê¸°ìˆ  ê°€ì´ë“œ (ìŠ¤ë§ˆíŠ¸íŒœ ì½”ë¦¬ì•„, ë†ì—…ê¸°ìˆ ì‹¤ìš©í™”ì¬ë‹¨ ì›¹/PDF), (3) ì‘ì—… ê¸°ë¡ (í˜„ì¥ ë†ê°€ ë©”ëª¨, Q\&A ê²Œì‹œíŒ).

\subsubsection{ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸}

% [Figure 3 placeholder - Preprocessing Pipeline]
\begin{figure}[htbp]
	\centering
	\fbox{\parbox{0.9\textwidth}{\centering \textbf{[Figure 3: Data Preprocessing Pipeline]} \\[1em]
			ì…ë ¥ (PDF/ì´ë¯¸ì§€/í…ìŠ¤íŠ¸) $\rightarrow$ OCR ì²˜ë¦¬ (EasyOCR) \\
			$\rightarrow$ ì‹œë§¨í‹± ì²­í‚¹ (200-500 í† í°) $\rightarrow$ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ \\
			(crop, category, causal\_role, numeric\_info, source)
		}}
	\caption{ë°ì´í„° ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸}
	\label{fig:preprocessing}
\end{figure}

\subsubsection{OCR ë° í…ìŠ¤íŠ¸ ì •ê·œí™”}

ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì„œëŠ” EasyOCRì„ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•œë‹¤. ì •ê·œí™” ê·œì¹™ì„ ì ìš©í•˜ì—¬ ì˜¨ë„(25ë„ $\rightarrow$ 25â„ƒ), EC(ì „ê¸°ì „ë„ë„ 2.5 $\rightarrow$ EC 2.5 dS/m), pH(ì‚°ë„ 6.5 $\rightarrow$ pH 6.5) ë“± ìˆ˜ì¹˜ í‘œí˜„ì„ í†µì¼í•œë‹¤.

\subsubsection{ì‹œë§¨í‹± ì²­í‚¹ ì „ëµ}

ë‹¨ìˆœ ê¸¸ì´ ê¸°ë°˜ ë¶„í•  ëŒ€ì‹ , ë¬¸ì„œì˜ ì˜ë¯¸ êµ¬ì¡°ë¥¼ ë³´ì¡´í•˜ëŠ” ì²­í‚¹ì„ ì ìš©í•œë‹¤. ì„¹ì…˜ ê¸°ë°˜ 1ì°¨ ë¶„í•  í›„ ì§§ì€ ì„¹ì…˜ì€ ì—°ê´€ ì„¹ì…˜ê³¼ ë³‘í•©í•˜ë©°, 50 í† í° ì˜¤ë²„ë©ìœ¼ë¡œ ë¬¸ë§¥ ì—°ì†ì„±ì„ í™•ë³´í•œë‹¤. ì²­í‚¹ íŒŒë¼ë¯¸í„°: \texttt{CHUNK\_MIN\_TOKENS}=200, \texttt{CHUNK\_MAX\_TOKENS}=500, \texttt{CHUNK\_OVERLAP}=50.

\subsubsection{ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì¶œ}

ê° ì²­í¬ì— ëŒ€í•´ crop(ì‘ë¬¼), category(ì¹´í…Œê³ ë¦¬), causal\_role(ì¸ê³¼ê´€ê³„ ì—­í• ), numeric\_info(ìˆ˜ì¹˜ ì •ë³´), source(ì¶œì²˜) ë©”íƒ€ë°ì´í„°ë¥¼ ê·œì¹™ ê¸°ë°˜ìœ¼ë¡œ ìë™ ì¶”ì¶œí•œë‹¤.

%----------------------------------------------------------------------
\subsection{ìŠ¤ë§ˆíŠ¸íŒœ ì˜¨í†¨ë¡œì§€}

\subsubsection{ì„¤ê³„ ë°°ê²½}

ì˜¨í†¨ë¡œì§€ ì„¤ê³„ëŠ” Stanford ì˜¨í†¨ë¡œì§€ êµ¬ì¶• ë°©ë²•ë¡ ~\cite{ref13}ê³¼ ê¸°ì¡´ ë†ì—… ì˜¨í†¨ë¡œì§€ ì—°êµ¬~\cite{ref9,ref10,ref11}ë¥¼ ì°¸ì¡°í•˜ì—¬ ìŠ¤ë§ˆíŠ¸íŒœ ë„ë©”ì¸ì— ì í•©í•œ 6ê°œ ê°œë… ìœ í˜•ì„ ì •ì˜í•˜ì˜€ë‹¤. CropDP-KG~\cite{ref12}ì˜ ì—”í‹°í‹° êµ¬ì¡°ì™€ AgriKG~\cite{ref21}ì˜ ë†ì—… ì—”í‹°í‹° ë¶„ë¥˜ë¥¼ ì°¸ê³ í•˜ì—¬ í•œêµ­ ìŠ¤ë§ˆíŠ¸íŒœ í™˜ê²½ì— ë§ê²Œ êµ¬ì„±í•˜ì˜€ë‹¤.

\subsubsection{ê°œë… ìœ í˜• ì •ì˜}

\input{tables/methodology/ontology}

ê° ê°œë…ì€ ë™ì˜ì–´/ìœ ì˜ì–´ ëª©ë¡(alias)ì„ í¬í•¨í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ``ì™€ì‚¬ë¹„''ì˜ aliasì—ëŠ” ``ì‚°ì™€ì‚¬ë¹„'', ``ë³¸ì™€ì‚¬ë¹„''ê°€ í¬í•¨ë˜ì–´ ì‚¬ìš©ìê°€ ì–´ë–¤ í‘œí˜„ì„ ì“°ë”ë¼ë„ ë™ì¼ ê°œë…ìœ¼ë¡œ ì¸ì‹í•œë‹¤.

%----------------------------------------------------------------------
\subsection{3ì±„ë„ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (HybridDAT)}

\subsubsection{ì„¤ê³„ ê·¼ê±°}

Dense retrievalì€ ì˜ë¯¸ì  ìœ ì‚¬ì„± ê²€ìƒ‰ì— ê°•í•˜ì§€ë§Œ ``EC 2.5 dS/m'' ê°™ì€ ìˆ˜ì¹˜ ì •ë³´ ë§¤ì¹­ì— ì·¨ì•½í•˜ë‹¤. Sparse retrievalì€ ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­ì— ê°•í•˜ì§€ë§Œ ì˜ë¯¸ì  ìœ ì‚¬ì„±ì„ ë†“ì¹  ìˆ˜ ìˆë‹¤~\cite{ref5}. ë³¸ ì‹œìŠ¤í…œì€ Dense-Sparse-PathRAG 3ì±„ë„ ìœµí•©ê³¼ ì§ˆì˜ íŠ¹ì„±ì— ë”°ë¥¸ ë™ì  ê°€ì¤‘ì¹˜ ì¡°ì •(Dynamic Alpha Tuning)ì„ ì ìš©í•œë‹¤.

\subsubsection{HybridDATRetriever í”Œë¡œìš°}

% [Figure 4 placeholder - HybridDAT flow diagram]
\begin{figure}[htbp]
	\centering
	\fbox{\parbox{0.9\textwidth}{\centering \textbf{[Figure 4: HybridDAT Retrieval Flow]} \\[1em]
			1. Query $\rightarrow$ Ontology Matching \\
			2. Dynamic Alpha Calculation (ìˆ˜ì¹˜/ë³‘í•´ ë¶„ì„) \\
			3. 3-Channel Parallel Search (Dense/Sparse/PathRAG) \\
			4. Score Fusion (Min-Max Normalization + Weighted Sum) \\
			5. Top-k $\times$ 2 Candidates
		}}
	\caption{HybridDATRetriever ê²€ìƒ‰ í”Œë¡œìš°}
	\label{fig:hybriddat}
\end{figure}

\subsubsection{ë™ì  ê°€ì¤‘ì¹˜ ê·œì¹™ (Dynamic Alpha)}

ì§ˆì˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ê°€ì¤‘ì¹˜ë¥¼ ìë™ ê²°ì •í•œë‹¤:

\input{tables/methodology/dynamic-alpha}

%----------------------------------------------------------------------
\subsection{ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„ (PathRAG-lite)}

\subsubsection{ì„¤ê³„ ë°°ê²½}

ë†ì—… ë„ë©”ì¸ì—ì„œ ``ê³ ìˆ˜ì˜¨ $\rightarrow$ ì—°ë¶€ë³‘ ë°œìƒ $\rightarrow$ ìˆ˜ì˜¨ ê´€ë¦¬'' ê°™ì€ ì¸ê³¼ ì²´ì¸ì´ í•µì‹¬ ì •ë³´ êµ¬ì¡°ë¥¼ í˜•ì„±í•œë‹¤~\cite{ref17}. GraphRAG~\cite{ref7}ëŠ” LLMìœ¼ë¡œ ê°œì²´ì™€ ê´€ê³„ë¥¼ ì¶”ì¶œí•˜ë¯€ë¡œ êµ¬ì¶• ë¹„ìš©ì´ ë†’ë‹¤(ë¬¸ì„œ 1000ê°œë‹¹ GPT-4 \$100+). ë³¸ ì‹œìŠ¤í…œì€ ê·œì¹™ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„ë¥¼ êµ¬ì¶•í•˜ì—¬ ë¹„ìš©ì„ \$0ìœ¼ë¡œ ì ˆê°í•œë‹¤.

\subsubsection{ì¸ê³¼ê´€ê³„ ì—­í•  ë¶„ë¥˜}

í…ìŠ¤íŠ¸ íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ë¬¸ì„œì˜ ì—­í• ì„ ë¶„ë¥˜í•œë‹¤:

\input{tables/methodology/causal-patterns}

\subsubsection{PathRAG-lite BFS íƒìƒ‰}

PathRAG~\cite{ref8}ì˜ ê²½ë¡œ íƒìƒ‰ ê°œë…ì„ ì°¨ìš©í•œ ê²½ëŸ‰ êµ¬í˜„ì´ë‹¤. BFS(ë„ˆë¹„ ìš°ì„  íƒìƒ‰) ê¸°ë°˜ 2-hop íƒìƒ‰ìœ¼ë¡œ ì›ì¸$\rightarrow$ê²°ê³¼$\rightarrow$í•´ê²°ì±… ë¬¸ì„œë¥¼ ìˆ˜ì§‘í•œë‹¤.

\subsubsection{ê·¸ë˜í”„ ìŠ¤í‚¤ë§ˆ}

CropDP-KG~\cite{ref12}ì™€ AgriKG~\cite{ref21}ì˜ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ë¥¼ ì°¸ì¡°í•˜ì—¬ êµ¬ì„±í•˜ì˜€ë‹¤.

\textbf{ë…¸ë“œ íƒ€ì…}: practice(ë¬¸ì„œ), crop, env, disease, nutrient, stage

\textbf{ì—£ì§€ íƒ€ì…}:
\begin{itemize}
	\item \texttt{recommended\_for}: ì‘ë¬¼ $\rightarrow$ ì‹¤ì²œ (AgriKG~\cite{ref21})
	\item \texttt{associated\_with}: ë³‘í•´ $\rightarrow$ ì‹¤ì²œ (CropDP-KG~\cite{ref12})
	\item \texttt{mentions}: ì‹¤ì²œ $\rightarrow$ ê°œë… (ë†ì—… ì˜¨í†¨ë¡œì§€~\cite{ref10})
	\item \texttt{causes}: ì‹¤ì²œ $\rightarrow$ ì‹¤ì²œ (ì¸ê³¼ ì¶”ì¶œ~\cite{ref14,ref15})
	\item \texttt{solved\_by}: ì‹¤ì²œ $\rightarrow$ ì‹¤ì²œ (ì¸ê³¼ ì¶”ì¶œ~\cite{ref14,ref15})
\end{itemize}

%----------------------------------------------------------------------
\subsection{Context Shaping (ì»¨í…ìŠ¤íŠ¸ ì••ì¶•)}

ì—£ì§€ LLMì€ í† í°ì´ ê³§ ì§€ì—°/ì „ë ¥ ë¹„ìš©ì´ë¯€ë¡œ, ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê·¸ëŒ€ë¡œ ì „ë‹¬í•˜ì§€ ì•Šê³  ì••ì¶•/í•„í„°ë§í•˜ëŠ” ê²ƒì´ í•µì‹¬ì´ë‹¤.

\subsubsection{Context Shaping íŒŒì´í”„ë¼ì¸}

% [Figure 5 placeholder - Context Shaping pipeline]
\begin{figure}[htbp]
	\centering
	\fbox{\parbox{0.9\textwidth}{\centering \textbf{[Figure 5: Context Shaping Pipeline]} \\[1em]
			Input (16 docs) $\rightarrow$ Crop Filter ($\sim$12 docs) \\
			$\rightarrow$ Semantic Dedup ($\sim$8 docs) $\rightarrow$ Reranking $\rightarrow$ Output (4 docs)
		}}
	\caption{Context Shaping íŒŒì´í”„ë¼ì¸}
	\label{fig:context_shaping}
\end{figure}

\subsubsection{ì‘ë¬¼ í•„í„°ë§ (Crop-aware Filtering)}

ë†ì—… ì§€ì‹ ê·¸ë˜í”„ ì—°êµ¬~\cite{ref4,ref12}ì—ì„œ ì‘ë¬¼ë³„ ë§¥ë½ ì˜ì¡´ì„±ì´ ê°•ì¡°ë˜ì—ˆë‹¤. ì§ˆì˜ì˜ ì‘ë¬¼ê³¼ ë¬¸ì„œì˜ ì‘ë¬¼ ë©”íƒ€ë°ì´í„°ë¥¼ ë¹„êµí•˜ì—¬ ìŠ¤ì½”ì–´ë¥¼ ì¡°ì •í•œë‹¤.

\input{tables/methodology/crop-filter}

\subsubsection{ì‹œë§¨í‹± ì¤‘ë³µ ì œê±° (Semantic Deduplication)}

MMR~\cite{ref18}ê³¼ VRSD~\cite{ref19}ë¥¼ ì°¸ì¡°í•˜ì—¬ ê²€ìƒ‰ ê²°ê³¼ì˜ ë‹¤ì–‘ì„±ì„ í™•ë³´í•œë‹¤. ë‘ ë¬¸ì„œì˜ ì„ë² ë”© ë²¡í„° ê°„ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ê°€ ì„ê³„ê°’($\theta$=0.85) ì´ìƒì¸ ë¬¸ì„œ ìŒì—ì„œ í›„ìˆœìœ„ ë¬¸ì„œë¥¼ ì œê±°í•œë‹¤.

\subsubsection{ë©”ëª¨ë¦¬ ì ì‘í˜• ë¦¬ë­í‚¹}

ëŸ°íƒ€ì„ ê°€ìš© ë©”ëª¨ë¦¬ì— ë”°ë¼ ë¦¬ë­ì»¤ë¥¼ ë™ì ìœ¼ë¡œ ì„ íƒí•œë‹¤:

\input{tables/methodology/reranking}

%----------------------------------------------------------------------
\subsection{ì—£ì§€ ë°°í¬ ìµœì í™”}

\subsubsection{ë©”ëª¨ë¦¬ ê³„ì¸µ êµ¬ì¡° (RAM vs Flash)}

ì—£ì§€ í™˜ê²½ì—ì„œ ``ë²¡í„° ì¸ë±ìŠ¤ê°€ RAMì— ë‹¤ ëª» ì˜¬ë¼ê°„ë‹¤''ëŠ” ë³‘ëª©ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ê³„ì¸µì  ë©”ëª¨ë¦¬ êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì˜€ë‹¤.

\begin{itemize}
	\item \textbf{RAM (Hot Data)}: Query Cache (LRU 128), Embedding Cache (LRU 256), FAISS mmap Active Pages, LLM Weights ($\sim$2.5GB)
	\item \textbf{Flash/SSD (Cold Data)}: dense.faiss (mmap), sparse.pkl, responses.jsonl, Causal Graph (in-memory built)
\end{itemize}

\subsubsection{LLM ì–‘ìí™” ì „ëµ}

llama.cppì˜ GGUF í¬ë§·~\cite{ref23}ì„ í™œìš©í•˜ì—¬ Q4\_K\_M ì–‘ìí™”ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì ìš©í•œë‹¤.

\input{tables/methodology/quantization}

Q4\_K\_Mì€ ì¤‘ìš”í•œ ë ˆì´ì–´ëŠ” 5ë¹„íŠ¸, ë‚˜ë¨¸ì§€ëŠ” 4ë¹„íŠ¸ë¡œ í˜¼í•© ì–‘ìí™”í•˜ì—¬ í’ˆì§ˆ ëŒ€ë¹„ ë©”ëª¨ë¦¬ íš¨ìœ¨ì˜ ìµœì ì ìœ¼ë¡œ í‰ê°€ëœë‹¤.

\subsubsection{ì˜¤í”„ë¼ì¸ í´ë°± ëª¨ë“œ}

ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ ë˜ëŠ” LLM ì¥ì•  ì‹œ ë‹¤ìŒê³¼ ê°™ì€ í´ë°± ì „ëµì„ ì ìš©í•œë‹¤:

\begin{enumerate}
	\item \textbf{Similar Cache}: ResponseCache.get\_similar() - ì„ë² ë”© ìœ ì‚¬ë„ $\geq$ 0.9ì¸ ì´ì „ ìœ ì‚¬ ì§ˆì˜ ì‘ë‹µ ì¬í™œìš©
	\item \textbf{Template Response}: TemplateResponder.generate() - ì˜¨í†¨ë¡œì§€ ë§¤ì¹­ ê¸°ë°˜ ì •í˜•í™”ëœ ì‘ë‹µ ìƒì„±
	\item \textbf{Search Only}: LLM ì—†ì´ ê²€ìƒ‰ ê²°ê³¼ë§Œ ë°˜í™˜
\end{enumerate}

%----------------------------------------------------------------------
\subsection{ëŸ°íƒ€ì„ ê²€ì¦ ë° ì‹ ë¢°ë„ í‘œì‹œ}

\textit{Note: ë³¸ ì„¹ì…˜ì€ ì‹œìŠ¤í…œì— ë‚´ì¥ëœ ëŸ°íƒ€ì„ ê²€ì¦ ê¸°ëŠ¥ì„ ë‹¤ë£¬ë‹¤. Ablation Study, Benchmark ë¹„êµ ë“± ì—°êµ¬ ë°©ë²•ë¡ ìœ¼ë¡œì„œì˜ í‰ê°€ëŠ” Section~\ref{sec:experiments}ì—ì„œ ìƒì„¸íˆ ê¸°ìˆ í•œë‹¤.}

ì—£ì§€ í™˜ê²½ì—ì„œ LLMì˜ í™˜ê°(hallucination) ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•´, ì‹œìŠ¤í…œì€ ì‘ë‹µ ìƒì„± ì‹œì ì— ë‹¤ìŒê³¼ ê°™ì€ ëŸ°íƒ€ì„ ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜ì„ ìˆ˜í–‰í•œë‹¤.

\subsubsection{ê·¼ê±° ì¶”ì  (Source Attribution)}

ìƒì„±ëœ ì‘ë‹µì˜ ê° ì£¼ì¥ì— ëŒ€í•´ ê·¼ê±° ë¬¸ì„œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°í•œë‹¤. LLM í”„ë¡¬í”„íŠ¸ì— ê²€ìƒ‰ëœ ë¬¸ì„œì™€ í•¨ê»˜ ``ê·¼ê±°ë¥¼ ëª…ì‹œí•˜ë¼''ëŠ” ì§€ì‹œë¥¼ í¬í•¨í•˜ê³ , ì‘ë‹µ ìƒì„± í›„ ì£¼ì¥-ë¬¸ì„œ ê°„ ì„ë² ë”© ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•˜ì—¬ ìœ ì‚¬ë„ê°€ ì„ê³„ê°’(0.7) ë¯¸ë§Œì¸ ì£¼ì¥ì— ëŒ€í•´ ê²½ê³ ë¥¼ í‘œì‹œí•œë‹¤.

\subsubsection{ëŸ°íƒ€ì„ í™˜ê° ê°ì§€}

% [Figure 6 placeholder - Hallucination Detection]
\begin{figure}[htbp]
	\centering
	\fbox{\parbox{0.9\textwidth}{\centering \textbf{[Figure 6: Verification Pipeline]} \\[1em]
			1. Claim Extraction (ì‘ë‹µì—ì„œ ì‚¬ì‹¤ì  ì£¼ì¥ ì¶”ì¶œ) \\
			2. Evidence Matching (ì£¼ì¥-ë¬¸ì„œ ìœ ì‚¬ë„ ê³„ì‚°) \\
			3. Consistency Check (ìˆ˜ì¹˜ ì •ë³´ ì¼ì¹˜ í™•ì¸) \\
			4. Confidence Scoring (HIGH/MEDIUM/LOW)
		}}
	\caption{ì‘ë‹µ ê²€ì¦ íŒŒì´í”„ë¼ì¸}
	\label{fig:verification}
\end{figure}

\subsubsection{ìˆ˜ì¹˜ ì •ë³´ ê²€ì¦}

ë†ì—… ë„ë©”ì¸ì—ì„œ ìˆ˜ì¹˜ ì •ë³´ì˜ ì •í™•ì„±ì€ íŠ¹íˆ ì¤‘ìš”í•˜ë‹¤. ë²”ìœ„ ê²€ì¦(ìˆ˜ì˜¨ 10-25â„ƒ, pH 5.5-7.5 ë“± ë„ë©”ì¸ ì§€ì‹ ê¸°ë°˜ í—ˆìš© ë²”ìœ„), ì¼ê´€ì„± ê²€ì¦(ê·¼ê±° ë¬¸ì„œ ë‚´ ìˆ˜ì¹˜ì™€ ë¹„êµ), ë‹¨ìœ„ ê²€ì¦(ë‹¨ìœ„ ë³€í™˜ ì •í™•ì„± í™•ì¸)ì„ ì ìš©í•œë‹¤.

\subsubsection{ì‹ ë¢°ë„ í‘œì‹œ}

ìµœì¢… ì‘ë‹µì—ëŠ” ì‹ ë¢°ë„ ìˆ˜ì¤€ì´ í•¨ê»˜ ì œê³µëœë‹¤:
\begin{itemize}
	\item \textbf{HIGH}: ëª¨ë“  ì£¼ì¥ì— ìœ ì‚¬ë„ $\geq$0.8 ê·¼ê±° ì¡´ì¬ - ì‘ë‹µ ì‹ ë¢° ê°€ëŠ¥
	\item \textbf{MEDIUM}: ì¼ë¶€ ì£¼ì¥ë§Œ ê·¼ê±° í™•ì¸ ($\geq$60\%) - ì¶”ê°€ í™•ì¸ ê¶Œì¥
	\item \textbf{LOW}: ê·¼ê±° í™•ì¸ ë¶ˆê°€ ($<$60\%) - ì „ë¬¸ê°€ ìƒë‹´ ê¶Œì¥
\end{itemize}

%----------------------------------------------------------------------
\subsection{ê´€ë ¨ ì—°êµ¬ì™€ì˜ ì°¨ë³„ì }

\textit{Note: ê´€ë ¨ ì—°êµ¬ì— ëŒ€í•œ í¬ê´„ì ì¸ ë¦¬ë·°ëŠ” Section~\ref{sec:related_work}ë¥¼ ì°¸ì¡°í•œë‹¤. ë³¸ ì„¹ì…˜ì—ì„œëŠ” ì œì•ˆ ë°©ë²•ë¡ ì˜ í•µì‹¬ ì°¨ë³„ì ì„ ìš”ì•½í•œë‹¤.}

\input{tables/methodology/comparison}
