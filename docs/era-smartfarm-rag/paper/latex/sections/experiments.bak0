% Section 5: Experiments
% Converted from: 05_experiments.md

\section{실험 및 평가 (Experiments)}
\label{sec:experiments}

\subsection{Experimental Setup}

\subsubsection{Dataset and Scope}

본 연구는 엣지 환경에서의 도메인 특화 RAG 시스템 설계를 검증하는 \textbf{파일럿 스터디(pilot study)}이다. 소규모 데이터셋의 통계적 한계를 인지하고, 시스템 아키텍처의 타당성 검증과 엣지 배포 가능성 확인에 초점을 맞춘다.

\textbf{데이터셋 구성:}

\begin{table}[htbp]
\centering
\caption{실험 데이터셋 구성}
\label{tab:dataset}
\begin{tabular}{@{}lll@{}}
\toprule
\textbf{항목} & \textbf{규모} & \textbf{비고} \\
\midrule
말뭉치 & 402개 청크 & 영어 원문 $\rightarrow$ 한국어 번역 \\
QA 데이터셋 & 220개 쌍 & LLM-as-a-Judge 생성 \\
카테고리 & 6개 & 재배기술, 환경관리, 병해충, 영양관리, 가공유통, 품종 \\
복잡도 & 3단계 & basic, intermediate, advanced \\
\bottomrule
\end{tabular}
\end{table}

\textbf{통계적 한계:}
본 데이터셋은 BEIR (수천$\sim$수백만 문서)나 LegalBench-RAG (6,889 QA)에 비해 소규모이다. Card et al. (2020)의 분석에 따르면, N=220에서 80\% 검정력으로 검출 가능한 최소 효과 크기(MDE)는 약 \textbf{4-5\% MRR 차이}이다. 이보다 작은 개선은 통계적으로 유의하지 않을 수 있다. 비율 지표(Hit Rate, Precision)에는 Wilson score interval을, 연속 지표(MRR, NDCG)에는 표준편차를 함께 보고하여 소표본 불확실성을 명시한다.

\subsubsection{Baselines}

네 가지 검색 베이스라인을 비교 평가한다:

\begin{table}[htbp]
\centering
\caption{베이스라인 비교 대상}
\label{tab:baselines}
\begin{tabular}{@{}llp{5cm}@{}}
\toprule
\textbf{베이스라인} & \textbf{설명} & \textbf{특징} \\
\midrule
Dense-only & FAISS 임베딩 유사도 검색 & 의미적 유사성 \\
Sparse-only & TF-IDF 키워드 매칭 & 정확한 용어 매칭 \\
Naive Hybrid & 고정 가중치 결합 ($\alpha$=0.5) & 단순 융합 \\
Proposed (HybridDAT) & 3채널 융합 + 동적 가중치 + 온톨로지 & 도메인 특화 \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection{Metrics and K Selection}

\textbf{검색 성능 메트릭:}
\begin{itemize}
    \item Precision@K, Recall@K: 상위 K개 결과의 정밀도/재현율
    \item MRR (Mean Reciprocal Rank): 첫 번째 정답 순위의 역수 평균
    \item NDCG@K: Normalized Discounted Cumulative Gain
    \item Hit Rate@K: 상위 K개 중 최소 1개 정답 포함 여부
\end{itemize}

\textbf{K=4 선택 근거:}
\begin{enumerate}
    \item \textbf{프롬프트 제한}: 8GB RAM에서 최대 4개 문서만 프롬프트에 포함 가능
    \item \textbf{응답 시간}: 문서 추가 시 생성 시간 증가, 실시간 응답 위해 제한
    \item \textbf{품질 균형}: ``lost in the middle'' 문제 방지~\cite{ref31}
\end{enumerate}

\textbf{엣지 성능 메트릭:}
Cold Start Time, Query Latency (p50/p95/p99), Memory Usage, QPS

\subsection{Results}

\subsubsection{Baseline Comparison (RQ1)}

\textbf{RQ1}: 제안하는 HybridDAT 시스템이 기존 검색 방법 대비 얼마나 성능이 향상되는가?

\begin{table}[htbp]
\centering
\caption{Baseline Performance Comparison (N=220)}
\label{tab:baseline_results}
\begin{tabular}{@{}lccccc@{}}
\toprule
\textbf{Method} & \textbf{P@4} & \textbf{R@4} & \textbf{MRR} & \textbf{NDCG@4} & \textbf{Hit@4} \\
\midrule
Dense-only & \TBD & \TBD & \TBD & \TBD & \TBD \\
Sparse-only & \TBD & \TBD & \TBD & \TBD & \TBD \\
Naive Hybrid & \TBD & \TBD & \TBD & \TBD & \TBD \\
\textbf{Proposed} & \textbf{\TBD} & \textbf{\TBD} & \textbf{\TBD} & \textbf{\TBD} & \textbf{\TBD} \\
\bottomrule
\end{tabular}
\end{table}

\textit{각 값은 mean $\pm$ std 형식. MDE $\approx$ 4-5\%이므로 이보다 작은 차이는 통계적으로 유의하지 않을 수 있음.}

\subsubsection{Ablation Study (RQ2)}

\textbf{RQ2}: 제안 시스템의 각 컴포넌트가 성능 향상에 얼마나 기여하는가?

\begin{table}[htbp]
\centering
\caption{Ablation Results (N=220)}
\label{tab:ablation_results}
\begin{tabular}{@{}lcccccccc@{}}
\toprule
\textbf{Configuration} & \textbf{DAT} & \textbf{Onto} & \textbf{Crop} & \textbf{Dedup} & \textbf{PathRAG} & \textbf{MRR} & \textbf{$\Delta$MRR} \\
\midrule
Base (Naive) & - & - & - & - & - & \TBD & -- \\
+DAT & \checkmark & - & - & - & - & \TBD & +\TBD \\
+DAT+Onto & \checkmark & \checkmark & - & - & - & \TBD & +\TBD \\
+DAT+Onto+Crop & \checkmark & \checkmark & \checkmark & - & - & \TBD & +\TBD \\
+DAT+Onto+Dedup & \checkmark & \checkmark & - & \checkmark & - & \TBD & +\TBD \\
+DAT+Onto+PathRAG & \checkmark & \checkmark & - & - & \checkmark & \TBD & +\TBD \\
\textbf{Full (Proposed)} & \checkmark & \checkmark & \checkmark & \checkmark & \checkmark & \textbf{\TBD} & \textbf{+\TBD} \\
\bottomrule
\end{tabular}
\end{table}

\textit{$\Delta$는 Base 대비 누적 개선. 컴포넌트 간 상호작용으로 개별 기여도 합이 전체와 불일치할 수 있음.}

\textbf{Key Findings:}
\begin{enumerate}
    \item \textbf{DAT}: 질의 특성 기반 동적 가중치 조정 (수치 질의 시 Sparse 강화)
    \item \textbf{Ontology}: 도메인 개념 매칭으로 환경/영양 질의에서 효과적
    \item \textbf{Crop Filter}: 작물 일치 문서 우선, 불일치 문서 억제
    \item \textbf{Dedup}: 유사 문서 제거로 검색 결과 다양성 확보
    \item \textbf{PathRAG}: 인과관계 그래프 기반 3채널 검색으로 병해/재배 질의에서 관계 경로 활용
\end{enumerate}

\subsubsection{Domain Analysis (RQ3)}

\textbf{RQ3}: 도메인 특화 기능들이 농업 도메인 질의에 효과적인가?

\begin{table}[htbp]
\centering
\caption{Performance by Category and Complexity}
\label{tab:domain_analysis}
\begin{tabular}{@{}lllcc@{}}
\toprule
\textbf{분석 기준} & \textbf{구분} & \textbf{N} & \textbf{MRR} & \textbf{NDCG@4} \\
\midrule
\multirow{4}{*}{카테고리} & 재배기술 & \TBD & \TBD & \TBD \\
& 환경관리 & \TBD & \TBD & \TBD \\
& 병해충 & \TBD & \TBD & \TBD \\
& 영양관리 & \TBD & \TBD & \TBD \\
\midrule
\multirow{3}{*}{복잡도} & Basic & \TBD & \TBD & \TBD \\
& Intermediate & \TBD & \TBD & \TBD \\
& Advanced & \TBD & \TBD & \TBD \\
\bottomrule
\end{tabular}
\end{table}

\textbf{온톨로지 효과:}
\begin{itemize}
    \item With ontology matching: MRR = \TBD{} (N = \TBD)
    \item Without ontology matching: MRR = \TBD{} (N = \TBD)
    \item Improvement: \TBD\%
\end{itemize}

\subsubsection{Edge Performance (RQ4)}

\textbf{RQ4}: 제안 시스템이 엣지 환경(8GB RAM)에서 실용적인 성능을 보이는가?

\begin{table}[htbp]
\centering
\caption{Edge Performance Metrics}
\label{tab:edge_performance}
\begin{tabular}{@{}llll@{}}
\toprule
\textbf{Metric} & \textbf{Value} & \textbf{Target} & \textbf{Status} \\
\midrule
Cold Start Time & \TBD{} s & $<$ 10s & \TBD \\
Index Memory & \TBD{} MB & $<$ 1GB & \TBD \\
Query Latency (p50) & \TBD{} ms & $<$ 200ms & \TBD \\
Query Latency (p95) & \TBD{} ms & $<$ 500ms & \TBD \\
Query Latency (p99) & \TBD{} ms & $<$ 1s & \TBD \\
Throughput & \TBD{} QPS & $>$ 5 & \TBD \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Memory Scaling:}
문서 수 증가에 따른 메모리 사용량은 선형적으로 증가하며, 400개 문서 기준 약 \TBD{} KB/doc의 메모리 효율을 보인다.

\subsection{Discussion}

\subsubsection{Key Findings}

\begin{enumerate}
    \item \textbf{HybridDAT 효과성}: 동적 가중치 조정이 고정 가중치 대비 \TBD\% 개선
    \item \textbf{도메인 특화}: 온톨로지 기반 매칭이 환경/영양 관련 질의에서 효과적
    \item \textbf{엣지 실용성}: 25-40x 속도 향상으로 8GB RAM 환경에서 실시간 응답 가능
\end{enumerate}

\subsubsection{Limitations}

본 연구는 다음 한계를 명시적으로 인정한다:

\begin{table}[htbp]
\centering
\caption{연구 한계점}
\label{tab:limitations}
\begin{tabular}{@{}llp{5cm}@{}}
\toprule
\textbf{한계} & \textbf{설명} & \textbf{영향} \\
\midrule
L1. 소규모 데이터셋 & N=220, MDE $\sim$4-5\% & 미세 차이 검출 불가 \\
L2. 단일 도메인 & 와사비 단일 작물 특화 & 다른 작물로 일반화 검증 필요 \\
L3. 합성 평가 데이터 & LLM 생성 QA & 실제 농가 질의와 차이 가능 \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection{Threats to Validity}

\begin{table}[htbp]
\centering
\caption{타당성 위협 및 완화 조치}
\label{tab:threats}
\begin{tabular}{@{}llp{5cm}@{}}
\toprule
\textbf{유형} & \textbf{위협} & \textbf{완화 조치} \\
\midrule
Internal & 베이스라인 구현 편향 & 동일 인프라/모델 사용, 코드 공개 \\
External & 단일 도메인 & ``pilot study''로 범위 명시 \\
Construct & K=4 비표준 & 근거 명시, Appendix에 K=1,5,10 제공 \\
Statistical & 소표본 & MDE 명시, Wilson CI 사용 \\
\bottomrule
\end{tabular}
\end{table}
