# ERA-SmartFarm-RAG ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ Figure ë””ìì¸ ì°¸ê³ ìë£Œ

> **ëª©ì **: ì—£ì§€ í™˜ê²½ìš© ìŠ¤ë§ˆíŠ¸íŒœ ë„ë©”ì¸ íŠ¹í™” RAG ì‹œìŠ¤í…œì˜ ë…¼ë¬¸ Figure ì‘ì„±ì„ ìœ„í•œ ìƒì„¸ ë””ìì¸ ê°€ì´ë“œ

---

## 0. ë©”ì¸ í”¼ê²¨: 3-Column ê°€ë¡œ ë°°ì¹˜ ì•„í‚¤í…ì²˜ (Figure 1 - ë…¼ë¬¸ í•µì‹¬)

> **ì„¤ê³„ ì›ì¹™**: System Pipeline(Phase 1, 2)ê³¼ Evaluation Protocolì„ **3ê°œ ì»¬ëŸ¼**ìœ¼ë¡œ ê°€ë¡œ ë°°ì¹˜í•˜ì—¬ í•œëˆˆì— ì „ì²´ ì—°êµ¬ íŒŒì´í”„ë¼ì¸ íŒŒì•…
> 
> - **Left Column (Blue)**: Phase 1 - ë°ì´í„° ìˆ˜ì§‘ ë° ì¸ë±ìŠ¤ êµ¬ì¶• (Offline)
> - **Center Column (Blue)**: Phase 2 - ëŸ°íƒ€ì„ ì¶”ë¡  (Online)
> - **Right Column (Orange)**: Evaluation Protocol - ë°ì´í„°ì…‹ ìƒì„± + ê²€ì¦/í‰ê°€ ë°©ë²•ë¡ 

### 0.1 3-Column Horizontal Layout (ê¶Œì¥ ë©”ì¸ í”¼ê²¨)

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                    ERA-SmartFarm-RAG: End-to-End Research Pipeline                                              â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ  ğŸ”µ PHASE 1: Data & Index Build    â”ƒ  ğŸ”µ PHASE 2: Runtime Inference        â”ƒ  ğŸŸ  EVALUATION PROTOCOL                             â”ƒ
â”ƒ      (Offline, One-time)           â”ƒ      (Online, Per-query)              â”ƒ      (Research Methodology)                         â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                    â”ƒ                                       â”ƒ                                                     â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚ â‘  DATA COLLECTION            â”‚  â”ƒ  â”‚ â‘£ QUERY ANALYSIS                â”‚  â”ƒ  â”‚ DATASET GENERATION (dataset-pipeline)       â”‚   â”ƒ
â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚   â”ƒ
â”ƒ  â”‚ Sources:                     â”‚  â”ƒ  â”‚ â€¢ OntologyMatcher.match()       â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ Web Crawl (Wiki, Brit.)    â”‚  â”ƒ  â”‚ â€¢ Dynamic Alpha Tuning:         â”‚  â”ƒ  â”‚ â”‚Self-Instructâ”‚â”€â–ºâ”‚ Question Generation â”‚    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ ë†ì´Œì§„í¥ì²­ PDF              â”‚  â”ƒ  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”ƒ  â”‚ â”‚(Wang, ACL23)â”‚  â”‚ Seed â†’ Diverse Q's  â”‚    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ ìŠ¤ë§ˆíŠ¸íŒœì½”ë¦¬ì•„ ê°€ì´ë“œ       â”‚  â”ƒ  â”‚   â”‚ ìˆ˜ì¹˜/ë‹¨ìœ„ â†’ Î±_s +0.2     â”‚ â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”ƒ
â”ƒ  â”‚                              â”‚  â”ƒ  â”‚   â”‚ í™˜ê²½/ì˜ì–‘ â†’ Î±_s +0.1     â”‚ â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚               â”‚   â”ƒ
â”ƒ  â”‚ Format:                      â”‚  â”ƒ  â”‚   â”‚ ë³‘í•´/ì¬ë°° â†’ Î±_p ~0.3-0.4 â”‚ â”‚  â”ƒ  â”‚ â”‚Evol-Instructâ”‚â”€â–ºâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚   â”ƒ
â”ƒ  â”‚ â€¢ PDF, Images, Text          â”‚  â”ƒ  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”ƒ  â”‚ â”‚(Xu, ICLR23) â”‚  Complexity â”‚               â”‚   â”ƒ
â”ƒ  â”‚ â€¢ EN/KO Bilingual            â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Evolution  â–¼               â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ                 â”‚                     â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”ƒ
â”ƒ                 â”‚                  â”ƒ                 â–¼                     â”ƒ  â”‚ â”‚    RAFT     â”‚â”€â–ºâ”‚ Answer Generation   â”‚    â”‚   â”ƒ
â”ƒ                 â–¼                  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚ â”‚(Zhang,COLM24â”‚  â”‚ Context-grounded    â”‚    â”‚   â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚ â‘¤ HYBRID RETRIEVAL (HybridDAT) â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”ƒ
â”ƒ  â”‚ â‘¡ PREPROCESSING              â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”ƒ  â”‚                            â”‚               â”‚   â”ƒ
â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”ƒ  â”‚                            â–¼               â”‚   â”ƒ
â”ƒ  â”‚ â€¢ Text extraction            â”‚  â”ƒ  â”‚ â”‚  Dense  â”‚ Sparse  â”‚PathRAG â”‚ â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ OCR fallback (EasyOCR)     â”‚  â”ƒ  â”‚ â”‚  FAISS  â”‚ TF-IDF  â”‚BFS 2hopâ”‚ â”‚  â”ƒ  â”‚ â”‚LLM-as-Judge â”‚â”€â–ºâ”‚ Quality Evaluation  â”‚    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ Sentence-window chunking   â”‚  â”ƒ  â”‚ â”‚  Î±_d    â”‚  Î±_s    â”‚  Î±_p   â”‚ â”‚  â”ƒ  â”‚ â”‚(Zheng,Neu24)â”‚  â”‚ Groundedness check  â”‚    â”‚   â”ƒ
â”ƒ  â”‚   (CHUNK_SIZE/STRIDE)        â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”ƒ  â”‚ â”‚+ Prometheus â”‚  â”‚ Accuracy scoring    â”‚    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ Metadata tagging:          â”‚  â”ƒ  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”ƒ  â”‚ â”‚(Kim, Neu24) â”‚  â”‚ Completeness eval   â”‚    â”‚   â”ƒ
â”ƒ  â”‚   crop, causal, numeric      â”‚  â”ƒ  â”‚              â”‚ Score Fusion    â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ ENâ†’KO Translation          â”‚  â”ƒ  â”‚              â–¼                 â”‚  â”ƒ  â”‚                            â”‚               â”‚   â”ƒ
â”ƒ  â”‚   (gemini-2.5-flash)         â”‚  â”ƒ  â”‚   final = Î±_dÃ—D + Î±_sÃ—S + Î±_pÃ—Pâ”‚  â”ƒ  â”‚                            â–¼               â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”ƒ
â”ƒ                 â”‚                  â”ƒ                 â”‚                     â”ƒ  â”‚               â”‚ ğŸ“¦ QA Dataset        â”‚      â”‚   â”ƒ
â”ƒ                 â–¼                  â”ƒ                 â–¼                     â”ƒ  â”‚               â”‚ â€¢ 220 QA pairs       â”‚      â”‚   â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚               â”‚ â€¢ 6 categories       â”‚      â”‚   â”ƒ
â”ƒ  â”‚ â‘¢ KNOWLEDGE STORE            â”‚  â”ƒ  â”‚ â‘¥ CONTEXT SHAPING              â”‚  â”ƒ  â”‚               â”‚ â€¢ ROUGE-L 0.93       â”‚      â”‚   â”ƒ
â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”ƒ  â”‚               â”‚ â€¢ Groundedness 0.52  â”‚      â”‚   â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”ƒ  â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”ƒ
â”ƒ  â”‚ â”‚ dense.faiss (mmap)       â”‚ â”‚  â”ƒ  â”‚ â”‚ Crop Filter               â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ FAISS IndexFlatIP      â”‚ â”‚  â”ƒ  â”‚ â”‚ â€¢ match: +0.5             â”‚  â”‚  â”ƒ                                                     â”ƒ
â”ƒ  â”‚ â”‚ â€¢ MiniLM / Qwen3-Emb     â”‚ â”‚  â”ƒ  â”‚ â”‚ â€¢ mismatch: Ã—0.15         â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”ƒ  â”‚ VERIFICATION                                â”‚   â”ƒ
â”ƒ  â”‚ â”‚ sparse.pkl               â”‚ â”‚  â”ƒ  â”‚               â”‚                â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ TfidfVectorizer        â”‚ â”‚  â”ƒ  â”‚               â–¼                â”‚  â”ƒ  â”‚ â€¢ Source Attribution                        â”‚   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ Keyword matching       â”‚ â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”ƒ  â”‚   (claim â†’ document mapping)                â”‚   â”ƒ
â”ƒ  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”ƒ  â”‚ â”‚ Semantic Dedup (Î¸=0.85)   â”‚  â”‚  â”ƒ  â”‚ â€¢ Groundedness Checks                       â”‚   â”ƒ
â”ƒ  â”‚ â”‚ Causal Graph (in-memory) â”‚ â”‚  â”ƒ  â”‚ â”‚ â€¢ cosine sim â‰¥ 0.85 ì œê±°  â”‚  â”‚  â”ƒ  â”‚   (keyword/source-hit verification)        â”‚   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ causes, solved_by edgesâ”‚ â”‚  â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”ƒ  â”‚ â€¢ Numerical Consistency                     â”‚   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ Built from doc metadataâ”‚ â”‚  â”ƒ  â”‚               â”‚ Top-kÃ—2 (8)    â”‚  â”ƒ  â”‚   (range/unit validation)                   â”‚   â”ƒ
â”ƒ  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”ƒ  â”‚               â–¼                â”‚  â”ƒ  â”‚ â€¢ Prompt Constraints                        â”‚   â”ƒ
â”ƒ  â”‚ â”‚ ontology.json            â”‚ â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ  â”‚ â”‚ â€¢ 6 types: crop, env,    â”‚ â”‚  â”ƒ                                 â”‚   â”ƒ                                                     â”ƒ
â”ƒ  â”‚ â”‚   nutrient, disease,     â”‚â—„â”¼â”€â”€â•‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€mmap loadâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ  â”‚ â”‚   stage, practice        â”‚ â”‚  â”ƒ                                     â”ƒ  â”‚ ABLATION STUDY                              â”‚   â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚   â”ƒ
â”ƒ  â”‚                              â”‚  â”ƒ  â”‚ â‘¥.5 RERANKING (Optional)       â”‚  â”ƒ  â”‚ Component-wise Analysis:                    â”‚   â”ƒ
â”ƒ  â”‚ Statistics:                  â”‚  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”ƒ  â”‚ â€¢ Dense-only        (w/o Sparse, PathRAG)   â”‚   â”ƒ
â”ƒ  â”‚ â€¢ ~100 documents             â”‚  â”ƒ  â”‚ Memory-aware selection:        â”‚  â”ƒ  â”‚ â€¢ Sparse-only       (w/o Dense, PathRAG)    â”‚   â”ƒ
â”ƒ  â”‚ â€¢ ~400 chunks                â”‚  â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”ƒ  â”‚ â€¢ w/o PathRAG       (Dense + Sparse only)   â”‚   â”ƒ
â”ƒ  â”‚ â€¢ Bilingual EN-KO            â”‚  â”ƒ  â”‚ â”‚ RAM < 0.8GB  â†’ none (skip) â”‚ â”‚  â”ƒ  â”‚ â€¢ w/o Context Shaping (no filter/dedup)    â”‚   â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚ â”‚ 0.8-1.5GB   â†’ LLM-lite    â”‚ â”‚  â”ƒ  â”‚ â€¢ w/o Dynamic Alpha (fixed Î±=0.5)          â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ â‰¥ 1.5GB     â†’ BGE Rerankerâ”‚ â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”ƒ                                                     â”ƒ
â”ƒ                                    â”ƒ  â”‚              â”‚ Final Top-k (4) â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ                                    â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚ BENCHMARK (Internal Baselines)              â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â”‚                     â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â–¼                     â”ƒ  â”‚ Comparison Targets:                         â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚ â€¢ vs Dense-only baseline                    â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â‘¦ LLM GENERATION               â”‚  â”ƒ  â”‚ â€¢ vs Sparse-only baseline                   â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”ƒ  â”‚ â€¢ vs Naive Hybrid (Î±=0.5 fixed)             â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ llama.cpp (Qwen3-0.6B, Q4_K_M) â”‚  â”ƒ  â”‚                                             â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚                                 â”‚  â”ƒ  â”‚ Dimensions:                                 â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”ƒ  â”‚ â€¢ Retrieval Quality (Recall, Precision)    â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ Fallback Chain:             â”‚ â”‚  â”ƒ  â”‚ â€¢ Edge Efficiency (Latency, Memory)        â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ 0. Exact Cache Hit          â”‚ â”‚  â”ƒ  â”‚ â€¢ Answer Quality (LLM-as-a-Judge)          â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ 1. Similar Cache (â‰¥0.9 sim) â”‚ â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ 2. Template Response        â”‚ â”‚  â”ƒ                                                     â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”‚ 3. Search-only Mode         â”‚ â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”ƒ  â”‚ ğŸ“Š EVALUATION METRICS                       â”‚   â”ƒ
â”ƒ                                    â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â”‚                     â”ƒ  â”‚                                             â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â–¼                     â”ƒ  â”‚ Retrieval Quality:                          â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ  â”‚ â€¢ Recall@k (k=1,4,10)                       â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ ğŸ“¤ OUTPUT                       â”‚  â”ƒ  â”‚ â€¢ Precision@k                               â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”ƒ  â”‚ â€¢ MRR (Mean Reciprocal Rank)                â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ {                               â”‚  â”ƒ  â”‚                                             â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚   answer: "ì™€ì‚¬ë¹„ ì ì • ìˆ˜ì˜¨...",â”‚  â”ƒ  â”‚ Edge Performance:                           â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚   sources: [chunk_042, ...],   â”‚  â”ƒ  â”‚ â€¢ End-to-end Latency (p50, p95, p99)        â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚   confidence: "HIGH",           â”‚  â”ƒ  â”‚ â€¢ Peak Memory Usage (MB)                    â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚   fallback_used: false          â”‚  â”ƒ  â”‚ â€¢ Throughput (QPS)                          â”‚   â”ƒ
â”ƒ                                    â”ƒ  â”‚ }                               â”‚  â”ƒ  â”‚                                             â”‚   â”ƒ
â”ƒ                                    â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ  â”‚ Answer Quality:                             â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â”‚                     â”ƒ  â”‚ â€¢ LLM-as-a-Judge Score (1-5)                â”‚   â”ƒ
â”ƒ                                    â”ƒ                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‹â”€â”€â”‚   - Groundedness                            â”‚   â”ƒ
â”ƒ                                    â”ƒ                       evaluated by    â”ƒ  â”‚   - Accuracy                                â”‚   â”ƒ
â”ƒ                                    â”ƒ                                       â”ƒ  â”‚   - Completeness                            â”‚   â”ƒ
â”ƒ                                    â”ƒ                                       â”ƒ  â”‚ â€¢ Source Attribution Rate                   â”‚   â”ƒ
â”ƒ                                    â”ƒ                                       â”ƒ  â”‚ â€¢ Hallucination Rate                        â”‚   â”ƒ
â”ƒ                                    â”ƒ                                       â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ  LEGEND                                                                                                                         â”ƒ
â”ƒ  â•â•â•â•â•â•â•                                                                                                                        â”ƒ
â”ƒ  ğŸ”µ System Pipeline: Deployed on edge device (8GB RAM, Jetson Orin Nano)                                                        â”ƒ
â”ƒ  ğŸŸ  Evaluation Protocol: Research methodology (offline analysis)                                                                â”ƒ
â”ƒ  â”€â”€â”€â–º Data Flow    â•â•â–º Index Load (mmap)    â”€ â”€ â–º Evaluation Input                                                              â”ƒ
â”ƒ                                                                                                                                 â”ƒ
â”ƒ  Models: Generator=gemini-2.5-flash | Judge=claude-sonnet-4-5 | LLM=Qwen3-0.6B Q4_K_M | Embed=MiniLM/Qwen3-Emb                  â”ƒ
â”ƒ  Edge Target (validated): 8GB RAM | Q4_K_M (~400MB) | p95 < 300ms                                                               â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

### 0.2 Graphviz DOT ë²„ì „ (LaTeX/ë…¼ë¬¸ìš© ê¶Œì¥)

```dot
digraph ERA_SmartFarm_RAG {
    rankdir=LR;
    compound=true;
    fontname="Helvetica";
    node [fontname="Helvetica", fontsize=9];
    edge [fontname="Helvetica", fontsize=8];
    
    // ===== PHASE 1: Data & Index Build (Blue) =====
    subgraph cluster_phase1 {
        label="ğŸ”µ PHASE 1: Data & Index Build\n(Offline, One-time)";
        style=filled;
        fillcolor="#E3F2FD";
        color="#1976D2";
        penwidth=2;
        
        dc [label="â‘  Data Collection\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nWeb Crawl (Wiki, Brit.)\në†ì´Œì§„í¥ì²­ PDF\nìŠ¤ë§ˆíŠ¸íŒœì½”ë¦¬ì•„ ê°€ì´ë“œ\nEN/KO Bilingual" shape=box];
        pp [label="â‘¡ Preprocessing\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOCR (EasyOCR)\nSentence-window chunking\nMetadata tagging\nENâ†’KO Translation" shape=box];
        ks [label="â‘¢ Knowledge Store\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ndense.faiss (mmap)\nsparse.pkl (TF-IDF)\nCausal Graph\nontology.json (6 types)" shape=cylinder];
        stats [label="Statistics\n~100 docs, ~400 chunks\nBilingual EN-KO" shape=note fontsize=8];
        
        dc -> pp -> ks;
        ks -> stats [style=dotted];
    }
    
    // ===== PHASE 2: Runtime Inference (Blue) =====
    subgraph cluster_phase2 {
        label="ğŸ”µ PHASE 2: Runtime Inference\n(Online, Per-query)";
        style=filled;
        fillcolor="#E3F2FD";
        color="#1976D2";
        penwidth=2;
        
        qa [label="â‘£ Query Analysis\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOntologyMatcher.match()\nDynamic Alpha Tuning\nìˆ˜ì¹˜â†’Î±_s+0.2\në³‘í•´â†’Î±_p~0.3" shape=box];
        hr [label="â‘¤ HybridDAT Retrieval\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nDense (FAISS) | Sparse (TF-IDF)\nPathRAG (BFS 2-hop)\nScore Fusion" shape=box];
        cs [label="â‘¥ Context Shaping\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nCrop Filter (+0.5/Ã—0.15)\nSemantic Dedup (Î¸=0.85)" shape=box];
        rr [label="â‘¥.5 Reranking\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nRAM<0.8â†’none\n0.8-1.5â†’LLM-lite\nâ‰¥1.5â†’BGE" shape=box style=dashed];
        llm [label="â‘¦ LLM Generation\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nQwen3-0.6B Q4_K_M\nFallback Chain:\n0.Exact Cache\n1.Similar Cache\n2.Template\n3.Search-only" shape=box];
        out [label="ğŸ“¤ OUTPUT\n{answer, sources,\nconfidence}" shape=box style=filled fillcolor="#C8E6C9"];
        
        qa -> hr -> cs -> rr -> llm -> out;
    }
    
    // ===== EVALUATION PROTOCOL (Orange) =====
    subgraph cluster_eval {
        label="ğŸŸ  EVALUATION PROTOCOL\n(Research Methodology)";
        style=filled;
        fillcolor="#FFF3E0";
        color="#F57C00";
        penwidth=2;
        
        // Dataset Generation
        subgraph cluster_dataset {
            label="Dataset Generation";
            style=rounded;
            fillcolor="#FFE0B2";
            
            si [label="Self-Instruct\n(Wang, ACL23)" shape=box fontsize=8];
            ei [label="Evol-Instruct\n(Xu, ICLR23)" shape=box fontsize=8];
            raft [label="RAFT\n(Zhang, COLM24)" shape=box fontsize=8];
            judge [label="LLM-as-a-Judge\n(Zheng, NeurIPS24)\n+ Prometheus" shape=box fontsize=8];
            dataset [label="ğŸ“¦ QA Dataset\n220 pairs\nROUGE-L 0.93" shape=box style=filled fillcolor="#FFCC80" fontsize=8];
            
            si -> ei -> raft -> judge -> dataset;
        }
        
        ver [label="Verification\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSource Attribution\nGroundedness\nNumerical Consistency" shape=box];
        abl [label="Ablation Study\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nDense-only\nSparse-only\nw/o PathRAG\nw/o Shaping" shape=box];
        bench [label="Benchmark\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nvs Dense-only\nvs Sparse-only\nvs Naive Hybrid" shape=box];
        
        subgraph cluster_metrics {
            label="ğŸ“Š Evaluation Metrics";
            style=rounded;
            fillcolor="#FFE0B2";
            
            m1 [label="Retrieval\nRecall@k, Precision@k\nMRR" shape=box fontsize=8];
            m2 [label="Edge Perf\nLatency (p50/p95/p99)\nMemory, Throughput" shape=box fontsize=8];
            m3 [label="Answer Quality\nLLM-Judge Score\nHallucination Rate" shape=box fontsize=8];
        }
        
        ver -> m1;
        abl -> m2;
        bench -> m3;
    }
    
    // Cross connections
    ks -> qa [style=dashed label="mmap load"];
    out -> ver [style=dotted label="evaluated by"];
}
```

### 0.3 Figure 1 í¬í•¨ ìš”ì†Œ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í”¼ë“œë°± ìš”êµ¬ì‚¬í•­ + í•™ìˆ  ê·œì•½)

| ìš”êµ¬ì‚¬í•­ | ë°˜ì˜ ì—¬ë¶€ | ìœ„ì¹˜ | ë¹„ê³  |
|----------|----------|------|------|
| âœ… **ë°ì´í„° ì»¬ë ‰ì…˜ ë° ì „ì²˜ë¦¬** | í¬í•¨ | Phase 1 (â‘ â‘¡â‘¢) | Web Crawl, OCR, Translation, Chunking |
| âœ… **Dataset Pipeline** | í¬í•¨ | Evaluation - Dataset Generation | Self-Instruct, Evol-Instruct, RAFT, LLM-as-a-Judge |
| âœ… **ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ êµ¬ì¡°** | í¬í•¨ | Phase 2 (â‘£â‘¤â‘¥â‘¦) | HybridDAT, Context Shaping, LLM |
| âœ… **í‰ê°€ ë©”íŠ¸ë¦­ ìƒì„¸** | í¬í•¨ | Evaluation - Metrics | Retrieval/Edge/Answer 3ì°¨ì› |
| âœ… **3-Column ê°€ë¡œ ë°°ì¹˜** | ì¶©ì¡± | Phase 1 \| Phase 2 \| Evaluation | í•œëˆˆì— ì „ì²´ íŒŒì´í”„ë¼ì¸ íŒŒì•… |
| âœ… **ì—£ì§€ ì œì•½ ëª…ì‹œ** | í¬í•¨ | LEGEND | 8GB RAM, Q4_K_M, p95<300ms |

### 0.4 Mermaid ë²„ì „ (3-Column êµ¬ì¡°)

```mermaid
flowchart LR
    subgraph Phase1["ğŸ”µ PHASE 1: Data & Index Build<br/>(Offline, One-time)"]
        direction TB
        DC["â‘  Data Collection<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Web Crawl (Wiki, Brit.)<br/>ë†ì´Œì§„í¥ì²­ PDF<br/>ìŠ¤ë§ˆíŠ¸íŒœì½”ë¦¬ì•„ ê°€ì´ë“œ<br/>EN/KO Bilingual"]
        PP["â‘¡ Preprocessing<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>OCR (EasyOCR)<br/>Sentence-window chunking<br/>Metadata tagging<br/>ENâ†’KO Translation"]
        KS["â‘¢ Knowledge Store<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>dense.faiss (mmap)<br/>sparse.pkl (TF-IDF)<br/>Causal Graph<br/>ontology.json"]
        STATS["ğŸ“Š ~100 docs<br/>~400 chunks"]
        DC --> PP --> KS --> STATS
    end
    
    subgraph Phase2["ğŸ”µ PHASE 2: Runtime Inference<br/>(Online, Per-query)"]
        direction TB
        QA["â‘£ Query Analysis<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>OntologyMatcher<br/>Dynamic Alpha Tuning<br/>ìˆ˜ì¹˜â†’Î±_s+0.2<br/>ë³‘í•´â†’Î±_p~0.3"]
        HR["â‘¤ HybridDAT Retrieval<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Dense|Sparse|PathRAG<br/>Score Fusion"]
        CS["â‘¥ Context Shaping<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Crop Filter (+0.5/Ã—0.15)<br/>Semantic Dedup (Î¸=0.85)"]
        RR["â‘¥.5 Reranking<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>RAM-aware selection<br/>BGE/LLM-lite/none"]
        LLM["â‘¦ LLM Generation<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Qwen3-0.6B Q4_K_M<br/>Fallback Chain"]
        OUT["ğŸ“¤ OUTPUT<br/>{answer, sources,<br/>confidence}"]
        QA --> HR --> CS --> RR --> LLM --> OUT
    end
    
    subgraph EvalLane["ğŸŸ  EVALUATION PROTOCOL"]
        direction TB
        
        subgraph DatasetGen["Dataset Generation (dataset-pipeline)"]
            SI["Self-Instruct<br/>(Wang, ACL23)"]
            EI["Evol-Instruct<br/>(Xu, ICLR23)"]
            RAFT["RAFT<br/>(Zhang, COLM24)"]
            JUDGE["LLM-as-a-Judge<br/>(Zheng, NeurIPS24)"]
            DATASET["ğŸ“¦ QA Dataset<br/>220 pairs<br/>ROUGE-L 0.93"]
            SI --> EI --> RAFT --> JUDGE --> DATASET
        end
        
        VER["Verification<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Source Attribution<br/>Groundedness<br/>Numerical Consistency"]
        ABL["Ablation Study<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Dense-only<br/>Sparse-only<br/>w/o PathRAG<br/>w/o Shaping"]
        BENCH["Benchmark<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>vs Dense-only<br/>vs Sparse-only<br/>vs Naive Hybrid"]
        
        subgraph Metrics["ğŸ“Š Evaluation Metrics"]
            M1["Retrieval<br/>Recall@k, MRR"]
            M2["Edge Perf<br/>Latency, Memory"]
            M3["Answer Quality<br/>LLM-Judge Score"]
        end
        
        VER --> M1
        ABL --> M2
        BENCH --> M3
    end
    
    KS -.->|"mmap load"| QA
    OUT -.->|"evaluated by"| VER
    
    subgraph Legend["LEGEND"]
        L1["ğŸ”µ System Pipeline: Edge Device (8GB RAM)"]
        L2["ğŸŸ  Evaluation: Research Methodology"]
        L3["Models: gemini-2.5-flash | claude-sonnet-4-5 | Qwen3-0.6B"]
    end
```

### 0.5 í•™ìˆ  ê·œì•½ ì¤€ìˆ˜ ì„¤ëª…

**ì™œ 3-Column ê°€ë¡œ ë°°ì¹˜ì¸ê°€?**

MobileRAG, EdgeRAG, PathRAG ë“± ì£¼ìš” RAG ë…¼ë¬¸ë“¤ì„ ë¶„ì„í•œ ê²°ê³¼, ë³¸ ì—°êµ¬ëŠ” **3-Column ê°€ë¡œ ë°°ì¹˜**ë¥¼ ì±„íƒ:

| ë…¼ë¬¸ | Main Figure êµ¬ì„± | ë³¸ ì—°êµ¬ ì°¨ë³„ì  |
|------|-----------------|----------------|
| MobileRAG (ACL 2024) | System Pipeline (6ë‹¨ê³„, ì„¸ë¡œ) | ê°€ë¡œ ë°°ì¹˜ë¡œ Phase 1/2/Eval ë³‘ë ¬ ë¹„êµ ê°€ëŠ¥ |
| EdgeRAG (SIGIR 2024) | Indexing + Retrieval | Dataset Pipeline í¬í•¨ìœ¼ë¡œ ë°ì´í„° ìƒì„± ê³¼ì • ì‹œê°í™” |
| PathRAG (EMNLP 2024) | Graph + Retrieval | í‰ê°€ ë©”íŠ¸ë¦­ 3ì°¨ì› (Retrieval/Edge/Answer) ìƒì„¸í™” |

**3-Column êµ¬ì¡°ì˜ ì¥ì **:
1. **Phase 1 (Offline)**: ë°ì´í„° ìˆ˜ì§‘/ì „ì²˜ë¦¬/ì¸ë±ì‹± - 1íšŒ ìˆ˜í–‰
2. **Phase 2 (Online)**: ëŸ°íƒ€ì„ ì¶”ë¡  íŒŒì´í”„ë¼ì¸ - ì¿¼ë¦¬ë‹¹ ìˆ˜í–‰
3. **Evaluation**: Dataset ìƒì„± + ê²€ì¦ + ë©”íŠ¸ë¦­ - ì—°êµ¬ ë°©ë²•ë¡ 

**í•µì‹¬ ì›ì¹™**:
1. **ê°€ë¡œ ë°°ì¹˜**: í•œëˆˆì— ì „ì²´ ì—°êµ¬ íŒŒì´í”„ë¼ì¸ íŒŒì•…
2. **Dataset Pipeline í†µí•©**: Self-Instruct â†’ Evol-Instruct â†’ RAFT â†’ LLM-as-a-Judge
3. **ë©”íŠ¸ë¦­ ìƒì„¸í™”**: Retrieval Quality / Edge Performance / Answer Quality 3ì°¨ì›

---

## 1. ì„¤ê³„ ì›ì¹™: ì—£ì§€ RAG ë…¼ë¬¸ì—ì„œ ì„¤ë“ë ¥ ìˆëŠ” í¬ì¸íŠ¸

### 1.1 ë¦¬ì†ŒìŠ¤ ì˜ˆì‚° ëª…ì‹œ (Resource Budget)

**í•µì‹¬**: ì„¤ê³„ ì œì•½ì„ ëª…í™•íˆ í•˜ë©´ ì´í›„ ìµœì í™”/ì„¤ê³„ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì •ë‹¹í™”ë¨

| ë¦¬ì†ŒìŠ¤ í•­ëª© | ERA-SmartFarm-RAG ì‚¬ì–‘ | ë¹„ê³  |
|------------|------------------------|------|
| **RAM** | 8GB (ìµœì†Œ) / 16GB (ê¶Œì¥) | Jetson Orin Nano íƒ€ê²Ÿ |
| **ì €ì¥ê³µê°„** | 10GB (ìµœì†Œ) / 20GB (ê¶Œì¥) | GGUF ëª¨ë¸ + FAISS ì¸ë±ìŠ¤ |
| **ëª©í‘œ ì§€ì—°** | 150-300ms (p95) | ì¿¼ë¦¬ â†’ ì‘ë‹µ ì „ì²´ |
| **LLM ë©”ëª¨ë¦¬** | ~2.5GB (Q4_K_M) | Qwen3-0.6B ì–‘ìí™” |
| **ì„ë² ë”© ëª¨ë¸** | ~90MB (MiniLM) / ~1.2GB (Qwen3-Emb) | ì—£ì§€/ì„œë²„ ë¶„ë¦¬ |
| **ì²˜ë¦¬ëŸ‰** | 3-8 QPS | ë‹¨ì¼ GPU ì—†ëŠ” CPU í™˜ê²½ |

**Figure í‘œí˜„ íŒ**: 
- Layer 0ì— "8GB RAM Budget", "Q4 Quantization" ê°™ì€ ì œì•½ ì¡°ê±´ì„ ë°•ìŠ¤ë¡œ ëª…ì‹œ
- MobileRAGì²˜ëŸ¼ "ë©”ëª¨ë¦¬/ì „ë ¥ ì œì•½ ë•Œë¬¸ì— ê¸°ì¡´ ë²¡í„°ê²€ìƒ‰ì´ ë¶€ì í•©"í•˜ë‹¤ëŠ” ì „ì œë¥¼ ì‹œê°í™”

---

### 1.2 ë©”ëª¨ë¦¬ ê³„ì¸µ (RAM vs Flash/Disk) + ë¶€ë¶„ ë¡œë”©

**í•µì‹¬**: "ë²¡í„° ì¸ë±ìŠ¤ê°€ RAMì— ë‹¤ ëª» ì˜¬ë¼ê°„ë‹¤"ëŠ” ë³‘ëª©ì„ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAM (Hot Data)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Query Cache â”‚  â”‚ Embedding   â”‚  â”‚ FAISS mmap active   â”‚  â”‚
â”‚  â”‚ (LRU 256)   â”‚  â”‚ Cache (256) â”‚  â”‚ pages only          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Flash/SSD (Cold Data)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ dense.faiss (mmap)  â”‚  sparse.pkl  â”‚  responses.jsonl  â”‚â”‚
â”‚  â”‚ [ì „ì²´ ì¸ë±ìŠ¤ íŒŒì¼]   â”‚  [TF-IDF]    â”‚  [ìºì‹œ ì˜ì†í™”]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ERA-SmartFarm-RAG êµ¬í˜„ í¬ì¸íŠ¸**:
- `DENSE_MMAP=true`: FAISS ì¸ë±ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ë§µìœ¼ë¡œ ì½ì–´ í•„ìš”í•œ ë¶€ë¶„ë§Œ RAM ë¡œë“œ
- `EmbeddingCache(max_size=256)`: ì¿¼ë¦¬ ì„ë² ë”© LRU ìºì‹œ
- `SimpleQueryCache(max_size=128)`: ê²€ìƒ‰ ê²°ê³¼ ìºì‹œ

---

### 1.3 ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´(í† í° ë¹„ìš©) ì ˆê° ë ˆì´ì–´

**í•µì‹¬**: ì—£ì§€ LLMì€ í† í°ì´ ê³§ ì§€ì—°/ì „ë ¥ â†’ "ê²€ìƒ‰ â†’ ê·¸ëŒ€ë¡œ ë¶™ì„"ì´ ì•„ë‹ˆë¼ ì••ì¶•/í•„í„°ë§ì´ í•µì‹¬

**ERA-SmartFarm-RAGì˜ Context Shaping ì „ëµ**:

| ë‹¨ê³„ | ê¸°ë²• | íš¨ê³¼ |
|------|------|------|
| **Semantic Dedup** | ì½”ì‚¬ì¸ ìœ ì‚¬ë„ â‰¥0.85 ë¬¸ì„œ ì œê±° | ì¤‘ë³µ ì»¨í…ìŠ¤íŠ¸ ë°©ì§€ |
| **Crop Filtering** | ì‘ë¬¼ ì¼ì¹˜ +0.5, ë¶ˆì¼ì¹˜ Ã—0.15 | ë¬´ê´€ ë„ë©”ì¸ ì •ë³´ ì–µì œ |
| **Dynamic Alpha** | ìˆ˜ì¹˜ ì§ˆì˜ â†’ Sparse ê°•í™” | ê²€ìƒ‰ ì •ë°€ë„ í–¥ìƒ |
| **Top-k ì œí•œ** | ê¸°ë³¸ k=4 | ì»¨í…ìŠ¤íŠ¸ í† í° ì œí•œ |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Context Shaping Layer                       â”‚
â”‚                                                             â”‚
â”‚  Retrieved (k*2)  â”€â”€â–¶  Crop Filter  â”€â”€â–¶  Semantic Dedup    â”‚
â”‚       16 docs           â‰ˆ12 docs          â‰ˆ8 docs          â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚                      Rerank (Optional)                      â”‚
â”‚                      BGE / LLM-lite                         â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚                      Final Top-k (4)                        â”‚
â”‚                      â†’ LLM Context                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.4 ì˜¤í”„ë¼ì¸/í”„ë¼ì´ë²„ì‹œ ëª©í‘œ

**í•µì‹¬**: "ë°ì´í„°ê°€ ë””ë°”ì´ìŠ¤ ë°–ìœ¼ë¡œ ì•ˆ ë‚˜ê°"ì€ ì—£ì§€ RAGì˜ ì¡´ì¬ ì´ìœ 

**ERA-SmartFarm-RAG ì˜¤í”„ë¼ì¸ í´ë°± ì „ëµ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Query Processing                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 0. Exact Cache  â”‚ â—€â”€â”€ ResponseCache.get(query)
                    â”‚    Lookup       â”‚     (ì •í™• ë§¤ì¹­)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ miss
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Hybrid Retrievalâ”‚ â—€â”€â”€ Dense + Sparse + PathRAG
                    â”‚ + Query Cache   â”‚     (SimpleQueryCache)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      LLM Generation          â”‚
              â”‚    (Qwen3-0.6B Q4_K_M)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ success        â”‚ failure        â”‚
            â–¼                â–¼                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚ Normal Answerâ”‚  â”‚ Fallback Chainâ”‚       â”‚
    â”‚ + Cache Save â”‚  â”‚               â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 1. Similar    â”‚       â”‚
                      â”‚    Cache (â‰¥0.9)â”‚       â”‚
                      â”‚ 2. Template   â”‚        â”‚
                      â”‚    Response   â”‚        â”‚
                      â”‚ 3. Search-onlyâ”‚        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
```

---

### 1.5 ëŸ°íƒ€ì„/ê°€ì†ê¸° ì¹œí™” ë ˆì´ì–´

**í•µì‹¬**: LLMì€ "ì–´ë–¤ ëŸ°íƒ€ì„ + ì–‘ìí™” + ê°€ì†ê¸°"ê°€ ì„±ëŠ¥ ì¢Œìš°

| êµ¬ì„±ìš”ì†Œ | ERA-SmartFarm-RAG ì„ íƒ | ëŒ€ì•ˆ |
|----------|------------------------|------|
| **LLM Runtime** | llama.cpp | AI Edge LLM, MLX |
| **ì–‘ìí™”** | GGUF Q4_K_M | Q2_K (ê·¹ì €ì‚¬ì–‘), INT8 |
| **ê°€ì†ê¸°** | CPU / CUDA | NPU (Jetson), Metal (Mac) |
| **ì„ë² ë”© ëŸ°íƒ€ì„** | SentenceTransformer | ONNX, Model2Vec |

---

## 2. ê¶Œì¥ ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜ í…œí”Œë¦¿

> ì—£ì§€ ê²½ëŸ‰ RAG ë…¼ë¬¸ìš© 6-Layer ìˆ˜í‰ ìŠ¤íƒ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Layer 5. Application & Policy                                       â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ â”‚ Streamlit UI   â”‚ â”‚ FastAPI REST    â”‚ â”‚ Offline Fallback Policy â”‚   â”ƒ
â”ƒ â”‚                â”‚ â”‚ /query /ingest  â”‚ â”‚ Cache â†’ Template â†’ Raw  â”‚   â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Layer 4. Generation & Grounding                                      â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ â”‚ Prompt Template        â”‚ â”‚ TemplateResponder (Fallback)       â”‚   â”ƒ
â”ƒ â”‚ build_rag_answer_promptâ”‚ â”‚ Ontology-based structured response â”‚   â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Layer 3. Context Shaping (í† í° ì ˆê° - ë…¼ë¬¸ í•µì‹¬ ê¸°ì—¬)                â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ â”‚ Crop Filter  â”‚ â”‚ Semantic Dedup â”‚ â”‚ Memory-aware Reranking     â”‚  â”ƒ
â”ƒ â”‚ +0.5/Ã—0.15   â”‚ â”‚ Î¸=0.85         â”‚ â”‚ BGE/LLM-lite/none by RAM   â”‚  â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Layer 2. Retrieval Core (3ì±„ë„ ìœµí•© ê²€ìƒ‰)                            â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”ƒ
â”ƒ â”‚           HybridDATRetriever (Dynamic Alpha Tuning)              â”‚â”ƒ
â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”ƒ
â”ƒ â”‚  â”‚   Dense    â”‚  â”‚   Sparse    â”‚  â”‚   PathRAG-lite             â”‚ â”‚â”ƒ
â”ƒ â”‚  â”‚  (FAISS)   â”‚  â”‚  (TF-IDF)   â”‚  â”‚  (Causal Graph BFS 2-hop)  â”‚ â”‚â”ƒ
â”ƒ â”‚  â”‚   Î±_d      â”‚  â”‚   Î±_s       â”‚  â”‚   Î±_p                      â”‚ â”‚â”ƒ
â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”ƒ
â”ƒ â”‚         â”‚               â”‚                    â”‚                   â”‚â”ƒ
â”ƒ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚â”ƒ
â”ƒ â”‚                         â–¼                                        â”‚â”ƒ
â”ƒ â”‚                  Score Normalization & Fusion                    â”‚â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Layer 1. On-device Knowledge Store                                   â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ â”‚                    SmartFarm Knowledge Base                     â”‚  â”ƒ
â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”ƒ
â”ƒ â”‚  â”‚ Dense Indexâ”‚  â”‚Sparse Index â”‚  â”‚ Causal Graph              â”‚â”‚  â”ƒ
â”ƒ â”‚  â”‚ dense.faissâ”‚  â”‚ sparse.pkl  â”‚  â”‚ (causes, solved_by edges) â”‚â”‚  â”ƒ
â”ƒ â”‚  â”‚ (mmap)     â”‚  â”‚             â”‚  â”‚                           â”‚â”‚  â”ƒ
â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”ƒ
â”ƒ â”‚                                                                 â”‚  â”ƒ
â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”ƒ
â”ƒ â”‚  â”‚ Domain Ontology (6 types)                                   â”‚â”‚  â”ƒ
â”ƒ â”‚  â”‚ crop | env | nutrient | disease | stage | practice         â”‚â”‚  â”ƒ
â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Layer 0. Device & Runtime (ì œì•½/ê°€ì†ê¸°)                              â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ â”‚     Hardware: CPU/GPU (Jetson Orin) | 8GB RAM | 10GB Storage   â”‚  â”ƒ
â”ƒ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”ƒ
â”ƒ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”ƒ
â”ƒ â”‚  â”‚ LLM: llama.cpp  â”‚  â”‚ Embedding:    â”‚  â”‚ VectorDB: FAISS  â”‚  â”‚  â”ƒ
â”ƒ â”‚  â”‚ Qwen3-0.6B      â”‚  â”‚ MiniLM (90MB) â”‚  â”‚ mmap enabled     â”‚  â”‚  â”ƒ
â”ƒ â”‚  â”‚ Q4_K_M (~400MB) â”‚  â”‚ or Qwen3-Emb  â”‚  â”‚                  â”‚  â”‚  â”ƒ
â”ƒ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## 3. ERA-SmartFarm-RAG í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 3.1 HybridDATRetriever (3ì±„ë„ ìœµí•©)

**ìœ„ì¹˜**: `core/Services/Retrieval/Hybrid.py`

```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    Query                              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              Ontology Matching                        â”‚
          â”‚  crop? env? disease? nutrient? stage? practice?       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            Dynamic Alpha Calculation                  â”‚
          â”‚                                                       â”‚
          â”‚  ì¼ë°˜ ì§ˆì˜:     Î±_d=0.5, Î±_s=0.5, Î±_p=0.0            â”‚
          â”‚  ìˆ˜ì¹˜ ì§ˆì˜:     Î±_d=0.3, Î±_s=0.7, Î±_p=0.0            â”‚
          â”‚  ë³‘í•´/ì¬ë°°:     Î±_d=0.35, Î±_s=0.35, Î±_p=0.3          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Dense      â”‚    â”‚    Sparse     â”‚    â”‚   PathRAG     â”‚
    â”‚   (FAISS)     â”‚    â”‚   (TF-IDF)    â”‚    â”‚  (Graph BFS)  â”‚
    â”‚               â”‚    â”‚               â”‚    â”‚               â”‚
    â”‚ Qwen3-Emb or  â”‚    â”‚  MiniStore    â”‚    â”‚ causes/       â”‚
    â”‚ MiniLM encode â”‚    â”‚  scores(q)    â”‚    â”‚ solved_by     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              Score Fusion & Normalization             â”‚
          â”‚                                                       â”‚
          â”‚  final_score = Î±_d Ã— dense + Î±_s Ã— sparse + Î±_p Ã— pathâ”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 Post-Processing                       â”‚
          â”‚                                                       â”‚
          â”‚  1. Crop Filter:     match +0.5 / mismatch Ã—0.15     â”‚
          â”‚  2. Semantic Dedup:  cosine â‰¥0.85 â†’ remove           â”‚
          â”‚  3. Top-k Selection: default k=4                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 PathRAG-lite (ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„ ê²€ìƒ‰)

**ìœ„ì¹˜**: `core/Services/Retrieval/PathRAG.py`, `core/Services/Ingest/GraphBuilder.py`

**ê·¸ë˜í”„ êµ¬ì¡°**:

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          SmartFarm Knowledge Graph          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚                                â”‚
        â–¼                                â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Concept Node â”‚                â”‚ Practice Node â”‚                â”‚  Edge Types   â”‚
â”‚               â”‚                â”‚  (Document)   â”‚                â”‚               â”‚
â”‚ crop:ì™€ì‚¬ë¹„   â”‚  recommended   â”‚ chunk_001     â”‚   causes       â”‚ recommended   â”‚
â”‚ env:ì˜¨ë„      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ chunk_002     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ associated    â”‚
â”‚ disease:ì—°ë¶€ë³‘â”‚  for           â”‚ chunk_003     â”‚   solved_by    â”‚ mentions      â”‚
â”‚ nutrient:ì–‘ì•¡ â”‚                â”‚               â”‚                â”‚ causes        â”‚
â”‚ stage:ìƒìœ¡    â”‚                â”‚ metadata:     â”‚                â”‚ solved_by     â”‚
â”‚ practice:ì°¨ê´‘ â”‚  associated    â”‚  causal_role: â”‚                â”‚               â”‚
â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  cause/effect â”‚                â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  with          â”‚  /solution    â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¸ê³¼ê´€ê³„ íƒìƒ‰ (BFS 2-hop)**:

```
Query: "ì™€ì‚¬ë¹„ ê³ ì˜¨ í”¼í•´ í•´ê²° ë°©ë²•"
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Ontology Match        â”‚
        â”‚ crop:ì™€ì‚¬ë¹„, env:ê³ ì˜¨ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (hop 0)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Start Nodes           â”‚
        â”‚ crop:ì™€ì‚¬ë¹„           â”‚
        â”‚ env:ì˜¨ë„ (ê³ ì˜¨ alias) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (hop 1)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Practice Docs         â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚ "ê³ ì˜¨ ì‹œ ì ì†ìƒ..."  â”‚ â—€â”€ causal_role: cause
        â”‚ "ìƒìœ¡ ì €í•˜ ë°œìƒ..."   â”‚ â—€â”€ causal_role: effect
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ causes / solved_by
                    â–¼ (hop 2)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Solution Docs         â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚ "ì°¨ê´‘ë§ ì„¤ì¹˜..."      â”‚ â—€â”€ causal_role: solution
        â”‚ "ìˆ˜ì˜¨ ê´€ë¦¬ í•„ìš”..."   â”‚ â—€â”€ causal_role: solution
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.3 ë©”ëª¨ë¦¬ ì ì‘í˜• ë¦¬ë­í‚¹

**ìœ„ì¹˜**: `core/Api/routes_query.py` (`_auto_reranker_mode`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Runtime Memory Check                            â”‚
â”‚                                                              â”‚
â”‚   RAM = _available_ram_gb()                                  â”‚
â”‚   VRAM = _available_vram_gb()                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
         â–¼             â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RAM < 0.8â”‚  â”‚0.8 â‰¤ RAM â”‚  â”‚RAM â‰¥ 1.5 â”‚
   â”‚   GB     â”‚  â”‚  < 1.5GB â”‚  â”‚   GB     â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   none   â”‚  â”‚ LLM-lite â”‚  â”‚   BGE    â”‚
   â”‚          â”‚  â”‚llama.cpp â”‚  â”‚BAAI/bge- â”‚
   â”‚ (skip)   â”‚  â”‚ rerank   â”‚  â”‚reranker  â”‚
   â”‚          â”‚  â”‚ (~0MB)   â”‚  â”‚ (~500MB) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.4 ì˜¤í”„ë¼ì¸ í´ë°± ëª¨ë“œ

**ìœ„ì¹˜**: `core/Services/ResponseCache.py`, `core/Services/TemplateResponder.py`

**ìºì‹± ë ˆì´ì–´ êµ¬ì„±**:
- **Query Cache** (`SimpleQueryCache`, max=128): ê²€ìƒ‰ ê²°ê³¼ ìºì‹± (`Hybrid.py`)
- **Response Cache** (`ResponseCache`, max=256, TTL=24h): LLM ì‘ë‹µ ìºì‹± (`ResponseCache.py`)
- **Embedding Cache** (`EmbeddingCache`, max=256): ì¿¼ë¦¬ ì„ë² ë”© ìºì‹± (`Settings.py`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Fallback Strategy                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    0. Exact Cache Hit?             â”‚ â—€â”€â”€ ResponseCache.get()
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚
                   HIT                  MISS
                    â”‚                    â”‚
                    â–¼                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Return Cachedâ”‚    â”‚     LLM Generation Attempt   â”‚
            â”‚  Response    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                                     â”‚                    â”‚
                                   SUCCESS             FAILURE
                                     â”‚                    â”‚
                                     â–¼                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Normal RAG   â”‚    â”‚     Fallback Chain           â”‚
                            â”‚ + Cache Save â”‚    â”‚                              â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  1. get_similar(query, â‰¥0.9) â”‚
                                                â”‚     â†’ ì„ë² ë”© ìœ ì‚¬ ìºì‹œ ì¡°íšŒ   â”‚
                                                â”‚                              â”‚
                                                â”‚  2. TemplateResponder        â”‚
                                                â”‚     â†’ ì˜¨í†¨ë¡œì§€ ê¸°ë°˜ ì •í˜• ì‘ë‹µ â”‚
                                                â”‚     "[ì™€ì‚¬ë¹„] ê´€ë ¨ ì •ë³´:     â”‚
                                                â”‚      - ì ì • ì˜¨ë„ 13-17â„ƒ..." â”‚
                                                â”‚                              â”‚
                                                â”‚  3. Search-only Mode         â”‚
                                                â”‚     â†’ ê²€ìƒ‰ ê²°ê³¼ë§Œ ë°˜í™˜       â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ê´€ë ¨ ì—°êµ¬ì™€ì˜ ë¹„êµ (Figure í¬í•¨ìš©)

### 4.1 EdgeRAG vs ERA-SmartFarm-RAG

| êµ¬ë¶„ | EdgeRAG [Seemakhupt 2024] | ERA-SmartFarm-RAG |
|------|---------------------------|-------------------|
| **ìµœì í™” ì´ˆì ** | ë²”ìš© ë©”ëª¨ë¦¬ ìµœì í™” | ë„ë©”ì¸ íŠ¹í™” + ì—£ì§€ |
| **ì¸ë±ì‹±** | ì˜¨ë¼ì¸ ê³„ì¸µì  ì¸ë±ì‹± | ì˜¤í”„ë¼ì¸ ì‚¬ì „ ì¸ë±ì‹± + mmap |
| **ê²€ìƒ‰ ì±„ë„** | ë‹¨ì¼ Dense | **Dense + Sparse + PathRAG** |
| **ê·¸ë˜í”„** | ì—†ìŒ | **ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„** |
| **ë„ë©”ì¸ ì§€ì‹** | ë²”ìš© | **ë†ì—… ì˜¨í†¨ë¡œì§€ 6ê°œ ìœ í˜•** |
| **ë©”ëª¨ë¦¬ ì ˆê°** | ê³„ì¸µì  ë¡œë”© 50%â†“ | **ì–‘ìí™” 75%â†“ + mmap** |

### 4.2 MobileRAG íŒ¨í„´ ë¹„êµ

| êµ¬ë¶„ | MobileRAG (EcoVector+SCR) | ERA-SmartFarm-RAG |
|------|---------------------------|-------------------|
| **ì¸ë±ìŠ¤ íŒŒí‹°ì…”ë‹** | k-means í´ëŸ¬ìŠ¤í„° ê³„ì¸µ | FAISS mmap (ì „ì²´ ì¸ë±ìŠ¤) |
| **ë¶€ë¶„ ë¡œë”©** | í´ëŸ¬ìŠ¤í„°ë³„ on-demand | mmap lazy load |
| **í† í° ì ˆê°** | SCR (Selective Content Reduction) | **Semantic Dedup + Crop Filter** |
| **ëŸ°íƒ€ì„** | AI Edge / MLX | **llama.cpp GGUF** |

---

## 5. ë…¼ë¬¸ Figure ê¶Œì¥ êµ¬ì„±

### Figure 1: System Architecture Overview

**ë‚´ìš©**: 6-Layer ìŠ¤íƒ ë‹¤ì´ì–´ê·¸ë¨ (Section 2 ì°¸ì¡°)

**ê°•ì¡° í¬ì¸íŠ¸**:
- Layer 0ì— "8GB RAM / Q4_K_M" ë¦¬ì†ŒìŠ¤ ì œì•½ ëª…ì‹œ
- Layer 1-2 ì‚¬ì´ì— **"RAM â†” Flash ê²½ê³„ì„ "** ì ì„ 
- Layer 2ì˜ 3ì±„ë„ ìœµí•©ì„ êµµì€ ë°•ìŠ¤ë¡œ
- Layer 3ì˜ Context Shapingì„ ë…¼ë¬¸ í•µì‹¬ ê¸°ì—¬ë¡œ í•˜ì´ë¼ì´íŠ¸

### Figure 2: Hybrid Retrieval Pipeline

**ë‚´ìš©**: HybridDATRetriever ë°ì´í„° í”Œë¡œìš° (Section 3.1 ì°¸ì¡°)

**ê°•ì¡° í¬ì¸íŠ¸**:
- Dynamic Alpha ê³„ì‚° ê·œì¹™ í…Œì´ë¸”
- 3ì±„ë„ ë³‘ë ¬ ê²€ìƒ‰ â†’ ìœµí•© â†’ í›„ì²˜ë¦¬ íë¦„

### Figure 3: Causal Graph Structure

**ë‚´ìš©**: SmartFarm Knowledge Graph ìŠ¤í‚¤ë§ˆ (Section 3.2 ì°¸ì¡°)

**ê°•ì¡° í¬ì¸íŠ¸**:
- 6ê°œ Concept Type ë…¸ë“œ
- `causes` / `solved_by` ì¸ê³¼ê´€ê³„ ì—£ì§€
- BFS 2-hop íƒìƒ‰ ì˜ˆì‹œ

### Figure 4: Offline Fallback Strategy

**ë‚´ìš©**: í´ë°± ì²´ì¸ í”Œë¡œìš°ì°¨íŠ¸ (Section 3.4 ì°¸ì¡°)

**ê°•ì¡° í¬ì¸íŠ¸**:
- Cache â†’ Template â†’ Search-only ë‹¨ê³„
- "ì˜¤í”„ë¼ì¸ì—ì„œë„ ê¸°ë³¸ ê²€ìƒ‰ ê°€ëŠ¥" ê°•ì¡°

---

## 6. í‰ê°€ ì§€í‘œ ê¶Œì¥ (Figure/Table í¬í•¨ìš©)

### 6.1 3ëŒ€ í•µì‹¬ ì§€í‘œ

| ì§€í‘œ | ì„¤ëª… | ëª©í‘œê°’ |
|------|------|--------|
| **End-to-end Latency** | ì§ˆì˜ â†’ ì‘ë‹µ ì „ì²´ ì‹œê°„ | p95 < 300ms |
| **Peak RAM Usage** | í”¼í¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | < 2GB |
| **Retrieval Quality** | Recall@k, Precision@k | Recall@4 > 0.7 |

### 6.2 ì¶”ê°€ í‰ê°€ í•­ëª©

| ì§€í‘œ | ì¸¡ì • ë°©ë²• |
|------|----------|
| **í† í° ì ˆê°ë¥ ** | ì¤‘ë³µ ì œê±° ì „/í›„ ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ ë¹„êµ |
| **ìºì‹œ íˆíŠ¸ìœ¨** | ë°˜ë³µ ì§ˆì˜ ì‹œ ResponseCache íˆíŠ¸ ë¹„ìœ¨ |
| **ì˜¤í”„ë¼ì¸ ì‘ë‹µ í’ˆì§ˆ** | í…œí”Œë¦¿ ì‘ë‹µ vs LLM ì‘ë‹µ ì •í™•ë„ ë¹„êµ |
| **ì±„ë„ ê¸°ì—¬ë„** | Dense-only vs Sparse-only vs Hybrid í’ˆì§ˆ ë¹„êµ |

### 6.3 íŠ¸ë ˆì´ë“œì˜¤í”„ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Context Shaping íš¨ê³¼ (í† í° ì ˆê° vs í’ˆì§ˆ)            â”‚
â”‚                                                                  â”‚
â”‚  Quality                                                         â”‚
â”‚     â–²                                                            â”‚
â”‚     â”‚        â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—                                         â”‚
â”‚     â”‚       /           \                                        â”‚
â”‚     â”‚      /             \                                       â”‚
â”‚     â”‚     â—               â—                                      â”‚
â”‚     â”‚    No Shaping    Full Shaping                              â”‚
â”‚     â”‚   (16 docs)      (4 docs)                                  â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Token Reduction   â”‚
â”‚          0%           50%           75%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ì½”ë“œ â†” Figure ë§¤í•‘

| Figure ìš”ì†Œ | ì†ŒìŠ¤ ì½”ë“œ ìœ„ì¹˜ |
|-------------|---------------|
| Layer 0 Runtime | `core/Config/Settings.py` |
| Layer 1 Knowledge Store | `core/Api/deps.py` (ì¸ë±ìŠ¤ ì´ˆê¸°í™”) |
| Layer 2 HybridRetriever | `core/Services/Retrieval/Hybrid.py` |
| Layer 2 PathRAG | `core/Services/Retrieval/PathRAG.py` |
| Layer 3 Context Shaping | `Hybrid.py` (`_deduplicate`, `_apply_crop_filter`) |
| Layer 4 Generation | `core/Services/LLM.py`, `PromptTemplates.py` |
| Layer 5 API | `core/Api/routes_query.py` |
| Fallback | `ResponseCache.py`, `TemplateResponder.py` |
| Graph Building | `core/Services/Ingest/GraphBuilder.py` |
| Ontology | `core/Services/Ontology.py` |

---

## 8. ìµœì‹  Edge RAG ì•„í‚¤í…ì²˜ íŒ¨í„´ ìƒì„¸ (2024-2025)

> librarian ì—ì´ì „íŠ¸ê°€ ìˆ˜ì§‘í•œ ìµœì‹  ì—°êµ¬ ë™í–¥

### 8.1 MobileRAG ì•„í‚¤í…ì²˜ (Park et al., 2025)

**í•µì‹¬ êµ¬ì„±: EcoVector + SCR (Selective Content Reduction)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EcoVector 2-Layer Indexing                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Level 1: Centroids Graph (RAM-resident, 50-200MB)                   â”‚
â”‚  â”œâ”€ k-means clustering of entire vector corpus                       â”‚
â”‚  â”œâ”€ HNSW graph built ONLY on cluster centroids                       â”‚
â”‚  â””â”€ Always in memory for query routing                               â”‚
â”‚                                                                      â”‚
â”‚  Level 2: Inverted Lists Graph (Disk-based)                          â”‚
â”‚  â”œâ”€ Independent HNSW graph per cluster                               â”‚
â”‚  â”œâ”€ Stored on flash storage                                          â”‚
â”‚  â””â”€ Loaded on-demand â†’ Immediately unloaded after search             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Search Flow:
Query â†’ Embed â†’ Centroids Graph (RAM) â†’ Identify n_P centroids
                      â†“
    Load n_P cluster graphs from disk â†’ Search â†’ Unload â†’ Return top-k
```

**SCR (í† í° ì ˆê°) ì•Œê³ ë¦¬ì¦˜**:

```
Retrieved Docs â†’ Sentence Split â†’ Sliding Window (3-5 sentences)
                                        â†“
              Query Similarity Scoring â†’ Select Top Windows â†’ Merge
                                        â†“
                        Token Reduction: ~42% average
```

**ERA-SmartFarm-RAGì™€ ë¹„êµ**:
- MobileRAG: í´ëŸ¬ìŠ¤í„° ê¸°ë°˜ ê³„ì¸µì  ì¸ë±ì‹±
- **ERA**: FAISS mmap (ì „ì²´ ì¸ë±ìŠ¤, OS í˜ì´ì§€ ìºì‹œ í™œìš©) â†’ êµ¬í˜„ ë‹¨ìˆœí™”

---

### 8.2 EdgeRAG ì•„í‚¤í…ì²˜ (Seemakhupt et al., 2024)

**í•µì‹¬: ì˜¨ë¼ì¸ ì¸ë±ì‹± + ì ì‘í˜• ìºì‹±**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EdgeRAG: Compute vs Data Tradeoff                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Level 1: IVF Centroids (Always in RAM)                              â”‚
â”‚  â””â”€ Query routing to cluster                                         â”‚
â”‚                                                                      â”‚
â”‚  Level 2: Cluster Embeddings (Selective)                             â”‚
â”‚  â”œâ”€ Heavy clusters (gen_time > SLO): Pre-computed & stored           â”‚
â”‚  â”œâ”€ Light clusters (gen_time < SLO): Discard, generate on-demand     â”‚
â”‚  â””â”€ Adaptive cache: Cost-aware LFU replacement                       â”‚
â”‚                                                                      â”‚
â”‚  Cache Policy:                                                       â”‚
â”‚  evict_score = generation_latency Ã— access_count                     â”‚
â”‚  â†’ Keep expensive-to-regenerate, frequently-accessed clusters        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Results (Jetson Orin Nano 8GB):
- TTFT: 1.8Ã— faster vs baseline IVF
- Datasets >8GB fit without thrashing
```

**ERA-SmartFarm-RAGì™€ ë¹„êµ**:
- EdgeRAG: ëŸ°íƒ€ì„ ì„ë² ë”© ìƒì„±ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì ˆì•½ (í’ˆì§ˆ trade-off)
- **ERA**: ì‚¬ì „ ì¸ë±ì‹± + mmapìœ¼ë¡œ í’ˆì§ˆ ìœ ì§€í•˜ë©´ì„œ ë©”ëª¨ë¦¬ ì ˆì•½

---

### 8.3 ì–‘ìí™” ì „ëµ ê°€ì´ë“œ (llama.cpp GGUF)

**ì–‘ìí™” ìˆ˜ì¤€ë³„ ê¶Œì¥ ì‚¬ìš© í™˜ê²½**:

| ì–‘ìí™” | ëª¨ë¸ í¬ê¸° (7B) | í’ˆì§ˆ | ì†ë„ | ê¶Œì¥ í™˜ê²½ |
|--------|---------------|------|------|----------|
| Q8_0 | ~7.5GB | Near FP16 | 1.0Ã— | ì„œë²„ |
| **Q4_K_M** | ~4.5GB | Good | 1.5Ã— | **8GB RAM ì—£ì§€ (ê¶Œì¥)** |
| IQ3_M | ~3.5GB | Moderate | 2.0Ã— | 4GB RAM ì—£ì§€ |
| IQ2_M | ~2.5GB | Degraded | 2.5Ã— | ê·¹ì €ì‚¬ì–‘ |

**KV ìºì‹œ ë©”ëª¨ë¦¬ ìµœì í™”** (ì£¼ìš” ë³‘ëª©):

```
7B Q4_K_M ë©”ëª¨ë¦¬ ë¶„í•´:
â”œâ”€ ëª¨ë¸ ê°€ì¤‘ì¹˜: ~4.5GB
â”œâ”€ KV ìºì‹œ (ctx=8192): ~2.8GB  â† ì£¼ìš” ë³‘ëª©!
â”œâ”€ í™œì„±í™”: ~1.0GB
â””â”€ ëŸ°íƒ€ì„ ì˜¤ë²„í—¤ë“œ: ~0.3GB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ê³„: ~8.6GB

ìµœì í™”: ctx=4096ìœ¼ë¡œ ì¤„ì´ë©´ â†’ ~6.0GB (KV ìºì‹œ ì ˆë°˜)
```

**ìµœì‹  KV ìºì‹œ ì–‘ìí™” ê¸°ë²•**:
- **AQUA-KV** (arXiv:2501.19392): 2-2.5ë¹„íŠ¸ì—ì„œ near-lossless
- **KeyDiff** (arXiv:2504.15364): í‚¤ ìœ ì‚¬ë„ ê¸°ë°˜ KV eviction

---

### 8.4 FAISS ë©”ëª¨ë¦¬ ìµœì í™” ê¸°ë²•

**Product Quantization (PQ) - ê³ ì••ì¶•**:

```
ì›ë³¸ ë²¡í„° (768 dims, FP16): 1536 bytes
       â†“
PQ ì••ì¶• (m=12, code_size=8): 12 bytes
       â†“
ì••ì¶•ë¥ : 128Ã—

ë©”ëª¨ë¦¬ ì¶”ì • (1M ë²¡í„°, 768 dims):
~12MB (ë²¡í„°) + ~98MB (ì½”ë“œë¶) + ~8MB (ID) = ~118MB
```

**FastScan (4-bit PQ)**:
- HNSW ëŒ€ë¹„ 2.7Ã— ë©”ëª¨ë¦¬ ì ˆê° (ê·¸ë˜í”„ ì˜¤ë²„í—¤ë“œ ì—†ìŒ)
- 64 bytes/vector ëª©í‘œ
- SIMD ê°€ì† CPU ì»¤ë„

**Binary Indexes (ê·¹í•œ ì••ì¶•)**:
```
768-dim FP16: 1536 bytes â†’ Binary: 96 bytes (16Ã— ì••ì¶•)
IndexBinaryHNSW: Hamming distanceë¡œ ê²€ìƒ‰
```

**ERA-SmartFarm-RAG ì ìš©**:
- í˜„ì¬: FAISS mmap + IndexFlatIP (ì •í™•ë„ ìš°ì„ )
- ëŒ€ì•ˆ: PQ ì ìš© ì‹œ ë©”ëª¨ë¦¬ 100Ã— ì ˆê° ê°€ëŠ¥ (Recall trade-off)

---

### 8.5 Edge RAG ì•„í‚¤í…ì²˜ íŒ¨í„´ ë¹„êµ

| íŒ¨í„´ | RAM ìš”êµ¬ | ì¸ë±ìŠ¤ ì „ëµ | í† í° ì ˆê° | ëŸ°íƒ€ì„ |
|------|---------|------------|----------|--------|
| **Pattern A: MobileRAG** | 4-7GB | EcoVector (í´ëŸ¬ìŠ¤í„° ê³„ì¸µ) | SCR (42%â†“) | AI Edge/MLX |
| **Pattern B: EdgeRAG** | 6-9GB | IVF + ì ì‘í˜• ìºì‹œ | ì—†ìŒ | llama.cpp |
| **Pattern C: Minimal** | 2-3GB | Binary PQ + mmap | KV ì–‘ìí™” | NanoLLM |
| **ERA-SmartFarm-RAG** | 0.8-1.5GB | FAISS mmap | Semantic Dedup + Crop Filter | llama.cpp |

**ERA-SmartFarm-RAGì˜ ì°¨ë³„ì **:
1. **ë„ë©”ì¸ íŠ¹í™”**: ë†ì—… ì˜¨í†¨ë¡œì§€ 6ê°œ ìœ í˜• + ì¸ê³¼ê´€ê³„ ê·¸ë˜í”„
2. **3ì±„ë„ ê²€ìƒ‰**: Dense + Sparse + PathRAG (ìˆ˜ì¹˜/ë‹¨ìœ„ ì •í™• ë§¤ì¹­)
3. **ê²½ëŸ‰ Context Shaping**: SCR ëŒ€ì‹  Semantic Dedup + Crop Filter (êµ¬í˜„ ë‹¨ìˆœ)
4. **ì˜¤í”„ë¼ì¸ í´ë°±**: Template Responderë¡œ LLM ì—†ì´ë„ ê¸°ë³¸ ì‘ë‹µ

---

### 8.6 ìµœì‹  ì–‘ìí™” ê¸°ë²• (2025)

**Mixed-Precision GEMM (mpGEMM)** - Microsoft Research:
```
Weight Ã— Activation ì¡°í•©:
â”œâ”€ int8 Ã— int1: ê·¹í•œ ì†ë„, ë‚®ì€ í’ˆì§ˆ
â”œâ”€ int8 Ã— int2: ê· í˜•
â”œâ”€ int8 Ã— int4: ì¢‹ì€ í’ˆì§ˆ + int8Ã—int8ë³´ë‹¤ ë¹ ë¦„
â””â”€ int8 Ã— int8: í‘œì¤€

Snapdragon X Elite ê²°ê³¼:
â”œâ”€ 7B ëª¨ë¸: 20-48 tok/sec
â””â”€ 3B ëª¨ë¸: 40-80 tok/sec
```

**T-MAC**: í…Œì´ë¸” ë£©ì—…ìœ¼ë¡œ ê³±ì…ˆ ëŒ€ì²´ â†’ dequantization ì˜¤ë²„í—¤ë“œ ì œê±°

**UniQL** (arXiv:2512.03383): ì–‘ìí™” + Low-Rank í†µí•© ì••ì¶•
- ë©”ëª¨ë¦¬: 4-5.7Ã— ê°ì†Œ
- ì²˜ë¦¬ëŸ‰: 2.7-3.4Ã— í–¥ìƒ

**FlexQuant** (arXiv:2501.07139): íƒ„ë ¥ì  ì–‘ìí™”
- ê°€ìš© ë©”ëª¨ë¦¬ì— ë”°ë¼ ë™ì  ì ì‘
- 15Ã— ì„¸ë¶„í™” ê°œì„ 

---

## 9. ì°¸ê³  ë¬¸í—Œ

### í•µì‹¬ ë…¼ë¬¸
- **MobileRAG**: Park, T., Lee, G., Kim, M.-S. (2025). "MobileRAG: A Fast, Memory-Efficient, and Energy-Efficient Method for On-Device RAG." [arXiv:2507.01079](https://arxiv.org/abs/2507.01079)
- **EdgeRAG**: Seemakhupt, K., Liu, S., Khan, S. (2024). "EdgeRAG: Online-Indexed RAG for Edge Devices." [arXiv:2412.21023](https://arxiv.org/abs/2412.21023)
- **PathRAG**: Chen, B., et al. (2025). "PathRAG: Pruning Graph-based RAG with Relational Paths." [arXiv:2502.14902](https://arxiv.org/abs/2502.14902)

### ì‹œìŠ¤í…œ/ëŸ°íƒ€ì„
- **llama.cpp**: Gerganov, G. (2024). [GitHub](https://github.com/ggml-org/llama.cpp)
- **FAISS**: Johnson, J., et al. (2019). "Billion-scale similarity search with GPUs." [arXiv:1702.08734](https://arxiv.org/abs/1702.08734)
- **Google AI Edge**: "Unlocking 7B+ language models in your browser." [Google Research Blog](https://research.google/blog/unlocking-7b-language-models-in-your-browser-a-deep-dive-with-google-ai-edges-mediapipe/)

### ì–‘ìí™”/ìµœì í™”
- **AQUA-KV**: Shutova, A., et al. (2025). "Cache Me If You Must: Adaptive Key-Value Quantization." [arXiv:2501.19392](https://arxiv.org/abs/2501.19392)
- **KeyDiff**: Park, J., et al. (2025). "KeyDiff: Key Similarity-Based KV Cache Eviction." [arXiv:2504.15364](https://arxiv.org/abs/2504.15364)
- **UniQL**: Wang, Y., et al. (2025). "UniQL: Unified Quantization and Low-Rank Compression." [arXiv:2512.03383](https://arxiv.org/abs/2512.03383)
- **FlexQuant**: Chen, X., et al. (2025). "FlexQuant: Elastic Quantization for Edge Devices." [arXiv:2501.07139](https://arxiv.org/abs/2501.07139)
- **ELUTQ**: Wang, H., et al. (2025). "ELUTQ: Efficient LUT-Aware Quantization." [arXiv:2510.19482](https://arxiv.org/abs/2510.19482)
- **LEANN**: Chen, J., et al. (2025). "LEANN: Storage-Efficient Vector Index." [arXiv:2506.08276](https://arxiv.org/abs/2506.08276)

### GGUF ì‹¤ë¬´
- **GGUF Optimization**: Hannecke, M. (2025). "GGUF Optimization: A Technical Deep Dive." [Medium](https://medium.com/@michael.hannecke/gguf-optimization-a-technical-deep-dive-for-practitioners-ce84c8987944)
- **llama.cpp KV Cache Discussion**: [GitHub #9784](https://github.com/ggml-org/llama.cpp/discussions/9784)
